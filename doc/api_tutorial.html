<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
  <title>Libdar API - Tutorial</title>

  
  
  <meta content="Denis Corbin" name="author">

  
  <meta content="Tutorial for using libdar library" name="description">

</head><body style="background-color: rgb(221, 221, 221); color: rgb(0, 0, 170);" alink="#ff0000" link="#0000ff" vlink="#000055">
<center>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; width: 161px;"><a href="index.html"><img style="border: 0px solid ; width: 160px; height: 120px;" alt="Dar Documentation" src="dar_s_doc.jpg"></a><br>
      </td>
      <td style="vertical-align: top;">
      <h1 style="text-align: center;"> LIBDAR <br>
      </h1>
      <h1 style="text-align: center;">APPLICATION INTERFACE <br>
      </h1>
      <h1 style="text-align: center;">TUTORIAL</h1>
      <div style="text-align: center;"> for API version 6.0.x and above<br>
      </div>
      <h1 style="text-align: center;"> </h1>
      </td>
    </tr>
  </tbody>
</table>
<div style="text-align: center;"><br>
</div>
<hr style="width: 100%; height: 2px;"><br>
<table style="width: 90%; margin-right: auto; margin-left: auto; text-align: left;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">
      <h2>Presentation</h2>
      <p style="text-align: justify;">The Libdar library provides a
complete abstraction layer for handling <span style="font-style: italic;">Dar</span><em></em> archives. The general
operations provided are:</p>
      
      
      <ul style="text-align: justify;">
        <li>archive creation, </li>
        <li>file extraction from archive, </li>
        <li>archive listing, </li>
        <li>archive testing, </li>
        <li>archive comparison,</li>
        <li>catalogue isolation,</li>
        <li>archive merging,</li>
        <li>archive reparation<br>
        </li>
        <li>dar_manager database manipulations</li>
        <li>dar_slave steering</li>
        <li>dar_xform operation<br>
        </li>
      </ul>
      
      <div style="text-align: justify;">Note that <span style="font-style: italic;">Disk ARchive</span> <em>and</em>
libdar
have been released under the <span style="font-style: italic;">Gnu
General Public License </span>(GPL). All code linked to libdar
(statically or dynamically), <span style="font-weight: bold;"> must
also be covered by the GPL.</span> Commercial use is prohibited unless
a contract has been agreeded with libdar's author.<br>
      </div>
      <div style="text-align: justify;"> <br>
      </div>
      <div style="text-align: justify;">This tutorial will show you how
to
use the libdar API.&nbsp; Since release 2.0.0 the <span style="font-style: italic;">dar</span> command-line executable also
relies on this API, looking at it's code may provide a good
illustration on the way to use libdar, the file <span style="font-style: italic;">src/dar_suite/dar.cpp</span>
is the primary consumer of the libdar API. <br>
      </div>
      <div style="text-align: justify;"> <br>
The sample codes provided here is
solely illustrative and is not guaranteed to compile. More detailed API
documentation is contained in the source code and can be compiled to
the doc/html directory using Doxygen, which is also provided <a href="http://dar.linux.free.fr/doc/html/index.html">online</a> and is referred below as the <span style="font-style: italic;">API reference documentation</span>.<br>
      </div>
      </td>
    </tr>
  </tbody>
</table>
<br>
<hr style="width: 100%; height: 2px;"><br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">
      <h2>Let's Start</h2>
      <h3>Conventions</h3>
      <h4>Language</h4>
      <div style="text-align: justify;">Dar and libdar are written in
C++, and so is the libdar API, for other languages check for the
existing bindings, like for example the <a href="http://darbinding.sourceforge.net/">python bindings</a>.<br>
      </div>
      <span style="font-weight: bold;"><br>
Header files</span><br>
      <br>
Only one include file is required in your program to have access to
libdar:<br>
      <br>
      <div style="margin-left: 40px;"><span style="font-family: monospace;">#include &lt;dar/libdar.hpp&gt;</span><br>
      </div>
      <h4>Libdar namespace</h4>
All libdar symbols are defined under
the <span style="font-style: italic; font-weight: bold;">libdar </span><span style="font-weight: bold;">namespace</span>. You
can either add the <span style="font-style: italic;">using namespace
libdar;</span> line at the beginning of your source files:<br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204);">
      <div style="margin-left: 40px;"><code>using
namespace libdar;</code><br>
      <code> </code><br>
      <code>get_version();</code><br>
      <code> </code></div>
      </td>
    </tr>
  </tbody>
</table>
<br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; text-align: justify;">&nbsp;or,
as shown below, you can
explicitly use the namespace in front of libdar symbols, we will use
this notation in the following: </td>
    </tr>
  </tbody>
</table>
<br>
<code></code>
<table style="width: 90%; height: 51px; text-align: left; margin-left: auto; margin-right: auto;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204);"><code><br>
      </code>
      <div style="margin-left: 40px;"><code>libdar::get_version();</code><br>
      <code> </code></div>
      </td>
    </tr>
  </tbody>
</table>
<br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">
      <h4>Exceptions<br>
      </h4>
      <div style="text-align: justify;">The library makes use of
exception to report unexpected conditions. These contain the reason and
context the error occurred in and can be caught by your code to display
this information. All exceptions used within libdar inherit from the
pure virtual class <span style="font-weight: bold;">libdar::Egeneric<br>
      </span><br>
Most of the time you will use only one of the following two methods:<br>
      <ul style="font-weight: bold;">
        <li><code>std::string &amp; get_message() const</code><br>
        </li>
        <li><code>std::string &amp; dump_str() const</code></li>
      </ul>
      <span style="font-weight: bold;">get_message() </span>returns a
message string describing the error met<br>
      <span style="font-weight: bold;">dump_str() </span>returns a
text paragraph with additional informations about the stack as well as
context the error occurred in.<br>
      <br>
We will only focus on one specific exception type <span style="font-weight: bold;">libdar::Ebug</span> that is used within
libdar when <span style="font-style: italic;">a-situation-that-should-never-occur</span>
is met and is assumed to be a bug in libdar. Using the <span style="font-weight: bold;">get_message()</span> method in that
situation would not provide all necessary details to understand and fix
the bug, so it is advised to always use <span style="font-weight: bold;">dump_str()</span> for that specific type of
exception.<br>
      </div>
      </td>
    </tr>
  </tbody>
</table>
<br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204); width: 50%;">
      <div style="margin-left: 40px;"><code>try</code><br>
      <code>{</code><br>
      <code>&nbsp;&nbsp;&nbsp; // calls to libdar</code><br>
      <code>&nbsp;&nbsp; ...</code><br>
      <code>&nbsp;&nbsp;&nbsp; //</code><br>
      <code>}</code><br>
      <code>catch(libdar::Ebug &amp; e)</code><br>
      <code>{</code><br>
      <code>&nbsp;&nbsp;&nbsp; std::string msg = e.dump_str();</code><br>
      <code></code><br>
      <code>&nbsp;&nbsp;&nbsp; // do someting with msg like for example:</code><br>
      <code>&nbsp;&nbsp;&nbsp; std::cerr &lt;&lt; msg </code><br>
      <code>}</code><br>
      <code>catch(libdar::Egeneric &amp; e)</code><br>
      <code>{</code><br>
      <code>&nbsp;&nbsp;&nbsp; std::string msg = e.get_message();</code><br>
      <code></code><br>
      <code>&nbsp;&nbsp;&nbsp; // do something with msg like for example</code><br>
      <code>&nbsp;&nbsp;&nbsp; std::cerr &lt;&lt; msg</code><br>
      <code>}</code><br>
      <code> </code></div>
      </td>
    </tr>
  </tbody>
</table>
<br>
<br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">
      <h2>&nbsp;1 - First we must initialize libdar <br>
      </h2>
      <div style="text-align: justify;">the libdar initialization is
performed by calling the <span style="font-weight: bold;">libdar::get_version()</span>
function. <br>
      <br>
This function can be called several time though only once is necessary,
but this call has to complete before any other call to libdar. <br>
      </div>
      <div> </div>
      <br>
      <div style="text-align: justify;">In a <span style="font-weight: bold;">multi-thread context </span>libthreadar
initialization is not re-entrant. In other word the first call call to <span style="font-weight: bold;">libdar::get_version()</span> must complete
before any other call to libdar can take place. Once libdar&nbsp; has
been initialized, you can call <span style="font-weight: bold;">libdar::get_version()</span>
concurrently from several threads at the same time.<br>
      </div>
      <br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204); width: 50%;"><code><br>
      </code>
      <div style="margin-left: 40px;"><code><span style="font-family: mon;"><span style="font-weight: bold;"></span></span><span style="font-weight: bold;">libdar::get_version();</span></code><br>
      <code></code></div>
      <code><br>
      </code> </td>
    </tr>
  </tbody>
</table>
<br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">
      <h2>2 - We should prepare the end right now<br>
      </h2>
      <div style="text-align: justify;">Libdar used
some
datastructures (mutex, secured memory, etc.) that need to be released
properly before ending the program. It is important to invoke the
following function before exiting your program if you invoked
get_version() previously.<br>
      </div>
      </td>
    </tr>
  </tbody>
</table>
<br>
<table style="text-align: left; width: 90%; background-color: rgb(204, 204, 204);" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204);"><code><span style="font-weight: bold;"><br>
      </span></code>
      <div style="margin-left: 40px;"><code style="font-weight: bold;">libdar::close_and_clean()</code><span style="font-weight: bold;"></span><br>
      <span style="font-weight: bold;"></span></div>
      <code style="font-weight: bold;"><br>
      </code></td>
    </tr>
  </tbody>
</table>
<br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">
      <div style="text-align: justify;"><span style="font-weight: bold; text-decoration: underline;">Note:</span> <span style="font-weight: bold;">closes_and_clean()</span>
makes the necessary for memory to be released in the proper order. <span style="text-decoration: underline;">Not
calling close_and_clean() at the end of your program may result in
uncaught exception message from libdar at the end of
the execution</span>. This depends on the compiler, libc and option
activated in libdar at compilation time.<br>
      </div>
      <br>
      <br>
All in one, at the higest level, you code should look like the following<br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<table style="text-align: left; width: 90%; background-color: rgb(204, 204, 204);" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204);"><code><span style="font-weight: bold;"><br>
      </span></code>
      <div style="margin-left: 40px;"><code>try</code><br>
      <code>{<br>
&nbsp;&nbsp;&nbsp; <span style="font-weight: bold;">libdar::get_version();</span><br>
      </code><code>&nbsp;&nbsp;&nbsp; // calls to libdar<br>
&nbsp;&nbsp;&nbsp; // thing we will see in next</code><br>
      <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...</code><br>
      <code>&nbsp; &nbsp;&nbsp; &nbsp; ...<br>
&nbsp;&nbsp;&nbsp;<span style="font-weight: bold;"> </span><br>
      </code><code>}</code><br>
      <code>catch(<span style="font-weight: bold;">libdar::Ebug &amp; e</span>)</code><br>
      <code>{</code><br>
      <code>&nbsp;&nbsp;&nbsp; std::string msg = <span style="font-weight: bold;">e.dump_str()</span>;</code><br>
      <code> </code><br>
      <code>&nbsp;&nbsp;&nbsp; // do someting with msg like for example:</code><br>
      <code>&nbsp;&nbsp;&nbsp; std::cerr &lt;&lt; msg </code><br>
      <code>}</code><br>
      <code>catch(<span style="font-weight: bold;">libdar::Egeneric
&amp; e</span>)</code><br>
      <code>{</code><br>
      <code>&nbsp;&nbsp;&nbsp; std::string msg = <span style="font-weight: bold;">e.get_message()</span>;</code><br>
      <code> </code><br>
      <code>&nbsp;&nbsp;&nbsp; // do something with msg like for example</code><br>
      <code>&nbsp;&nbsp;&nbsp; std::cerr &lt;&lt; msg</code><br>
      <code>}<br>
      <br>
      </code><code><span style="font-weight: bold;">libdar::close_and_clean();</span></code><br>
      </div>
      <code style="font-weight: bold;"><br>
      </code></td>
    </tr>
  </tbody>
</table>
<br>
<br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">
      <h2>3 - Intercepting signals</h2>
      <div style="text-align: justify;">libdar by itself does not make
use of any signal (see signal(2) and
kill(2)). However, gpgme library with which libdar may be linked with
in order to
support asymetrical strong encryption (i.e. encryption using
public/private keys) may trigger the PIPE signal. Your application
shall thus
either ignore it (signal(SIGPIPE, SIG_IGN)) or provide an adhoc handle.
By default the PIPE signal leads the receiving processus to terminate.<br>
      </div>
      </td>
    </tr>
  </tbody>
</table>
<br>
<hr style="width: 100%; height: 2px;"><br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">
      <h2>4 - Libdar classes<br>
      </h2>
The main components of libdar are a set of&nbsp; classes:<span style="font-weight: bold;"></span>
      <ul>
        <li><span style="font-weight: bold;">class libdar::archive</span>
to play with dar archives<br>
          <span style="font-weight: bold;"></span></li>
        <li><span style="font-weight: bold;">class libdar::database </span>to
play with dar_manager databases</li>
        <li><span style="font-weight: bold;">class libdar::libdar_slave</span>
to take the role of dar_slave<br>
        </li>
        <li><span style="font-weight: bold;">class libdar::libdar_xform</span>
to reslice existing archives like dar_xform does</li>
      </ul>
In the following we will first see <span style="font-weight: bold;">class
libdar::archive</span> which will take most of our effort as other
classes which we will see at the end are very simple to use.<br>
      <br>
      <h2>5 - Multithreaded environment</h2>
      <div style="text-align: justify;">Except some exceptions that
will be mentionned, a given libdar object can only be manpulated by a
single thread. You can however perform several operations concurrently
from different thread, each having its own set of objects. Though, if
one
thread is creating an archive by mean of an first object and at the
same
time another thread by mean of a second object is trying to read the
archive under construction, things might not work as expected, but this
is obvious considerations we will not dig any further assuming you
know what you are doing.<br>
      </div>
      <h2>6 - Let's create a simple archive</h2>
      <span style="font-weight: bold;"></span>Creating a <span style="font-weight: bold;">libdar::archive</span> object depending on
the constructor used leads to either:<br>
      <ul>
        <li>the creation of a brand new archive on filesystem, thus
performing a backup (full, incremental, differential, decremental, ...)<br>
        </li>
        <li>opening an archive existing on filesystem, for further
operation (listing,&nbsp; file restoration,&nbsp; archive testing,
archive difference, ...) <br>
        </li>
        <li>merging two existing archives into a new one</li>
        <li>repair an archive which catalogue (i.e.: table of content
is missing)</li>
      </ul>
      <h3>6.1 - Basic archive creation</h3>
For <span style="font-weight: bold;">archive creation</span> the
constructor format is the following one:<br>
      <br style="font-weight: bold;">
      <code><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
archive::archive(const std::shared_ptr&lt;user_interaction&gt; &amp;
dialog,</span><br style="font-weight: bold;">
      <span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const path &amp; fs_root,</span><br style="font-weight: bold;">
      <span style="font-weight: bold;">&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const path &amp; sauv_path,</span><br style="font-weight: bold;">
      <span style="font-weight: bold;">&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const std::string &amp; filename,</span><br style="font-weight: bold;">
      <span style="font-weight: bold;">&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const std::string &amp; extension,</span><br style="font-weight: bold;">
      <span style="font-weight: bold;">&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const archive_options_create &amp; options,</span><br style="font-weight: bold;">
      <span style="font-weight: bold;">&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
statistics * progressive_report);</span><br>
      <br>
      </code>For now we will left beside several parameters we will see
in detail later:<br>
      <ul style="text-align: justify;">
        <li style="text-align: justify;"><span style="font-weight: bold;">dialog</span> can be set to <span style="font-weight: bold;">a null pointer</span> for now, this means
that all interaction with the user will be done by mean of standard
input, output and error.</li>
        <li style="text-align: justify;"><span style="font-weight: bold;">fs_root</span> is the directory to take as
root of the backup. The <span style="font-weight: bold;">libdar::path</span>
class can be setup from a <span style="font-weight: bold;">std::string</span></li>
        <li style="text-align: justify;"><span style="font-weight: bold;">sauv_path </span>is the path where to
write the archive to, here also a <span style="font-weight: bold;">std::string</span>
will do the job</li>
        <li style="text-align: justify;"><span style="font-weight: bold;">filename</span> is the <span style="font-weight: bold;">slice name</span> of the archive to create</li>
        <li style="text-align: justify;"><span style="font-weight: bold;">extension</span> is the archive extension
to use. There is no reason to not use the string <span style="font-weight: bold;">"dar"</span> here</li>
        <li style="text-align: justify;"><span style="font-weight: bold;">options</span> is a class that carries all
optional parameters, it contains a <span style="font-weight: bold;">constructor
without argument</span> so all options are set to their default that way</li>
        <li style="text-align: justify;"><span style="font-weight: bold;">statistics</span> can
receive the address of an existing object that another thread can read
while a first one is doing a backup operation, we will see this feature
later on, but for now let's set this to a <span style="font-weight: bold;">null pointer</span>.</li>
      </ul>
      <div style="text-align: justify;">Once the object has been
created (the constructor has returned), the
archive operation has completed and a new file has been completely
written on disk.<br>
      </div>
      </td>
    </tr>
  </tbody>
</table>
<br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204); width: 50%;">
      <div style="margin-left: 40px;"><code>libdar::archive
my_first_backup(nullptr,</code><br>
      <code>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; "/home/me",</code><br>
      <code>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; "/tmp",</code><br>
      <code>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;
"first_backup",</code><br>
      <code>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;
"dar",</code><br>
      <code>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; archive_options_create(),</code><br>
      <code>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; nullptr);<br>
      </code></div>
      </td>
    </tr>
  </tbody>
</table>
<br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; text-align: justify;">Thus, the
previous command will create a single sliced archive "<span style="font-weight: bold;">first_backup.1.dar</span>" located under <span style="font-weight: bold;">/tmp</span>. It will contain the content of
the directory <span style="font-weight: bold;">/home/me</span>
and its subdirectories, without compression and without ciphering. You
have guessed compression, slicing, ciphering can be set by playing with
passing an adhoc <span style="font-weight: bold;">archive_option_create</span>
object to this archive constructor, we will se that later.<br>
      <br>
Once the object has been created there is only little thing we can do
with it, like archive listing or archive isolation. But archive
extraction, testing or diffing needs&nbsp; creating a object with a
"read" constructor first.<br>
      <br>
We could also have allocated the archive on the heap, in that case we
would have just added the <span style="font-weight: bold;">delete</span>
operation after the construction has ended:<br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204); width: 50%;">
      <div style="margin-left: 40px;"><code>libdar::archive*
my_first_backup = <span style="font-weight: bold;">new</span>
libdar::archive(nullptr,</code><br>
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <code>&nbsp;
&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;
"/home/me",</code><br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <code>&nbsp; &nbsp; &nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; "/tmp",</code><br>
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <code>&nbsp;
&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;
"first_backup",</code><br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <code>&nbsp; &nbsp; &nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; "dar",&nbsp; </code><br>
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<code>&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
archive_options_create(),</code><br>
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<code>&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
nullptr);<br>
&nbsp; // we assume std::bad_alloc would be thrown if an allocation
problem had occured<br>
&nbsp; // same thing if libdar throws an exception at constructor time,
the object would<br>
&nbsp; // not be created and would not have to be deleted.<br>
&nbsp; // So now we can delete the created object:<br>
      <br>
      <span style="font-weight: bold;">delete</span> my_first_backup;<br>
      </code></div>
      </td>
    </tr>
  </tbody>
</table>
<br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">
      <h3>6.2 - Progressive report</h3>
      <div style="text-align: justify;">During the operation we get
nothing shown unless an error occurs. To have more visibility on the
process we will use an <span style="font-weight: bold;">libdar::statistics</span>
object passed as last argument of this constructor. The useful method
of class libdar::statistics are:<br>
      <ul>
        <li>std::string <span style="font-weight: bold;">get_treated_str()</span><br>
        </li>
        <li>std::string <span style="font-weight: bold;">get_hard_links_str()</span>
          <br>
        </li>
        <li>std::string <span style="font-weight: bold;">get_skipped_str()</span><br>
        </li>
        <li>std::string <span style="font-weight: bold;">get_inode_only_str()</span><br>
        </li>
        <li>std::string <span style="font-weight: bold;">get_ignored_str()</span></li>
        <li>std::string <span style="font-weight: bold;">get_tooold_str()</span></li>
        <li>std::string <span style="font-weight: bold;">get_errored_str()
          </span><br>
        </li>
        <li>std::string <span style="font-weight: bold;">get_deleted_str()</span></li>
        <li>std::string <span style="font-weight: bold;">get_ea_treated_str()
          </span><br>
        </li>
        <li>std::string <span style="font-weight: bold;">get_byte_amount_str()</span></li>
        <li>std::string <span style="font-weight: bold;">get_fsa_treated_str()</span><br>
        </li>
      </ul>
If you have a doubt about the meaning and use of a particular counter
in a particular operation, please refer to the doxygen documentation of
class statistics, the private fields corresponding ot these counter are
explicitely defined there.<br>
      </div>
      </td>
    </tr>
  </tbody>
</table>
<br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204); width: 50%;">
      <div style="margin-left: 40px;"><code><span style="font-weight: bold;">libdar::statistics stats;</span><br>
      <br>
libdar::archive my_first_backup(nullptr,</code><br>
      <code>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; "/home/me",</code><br>
      <code>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; "/tmp",</code><br>
      <code>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;
"first_backup",</code><br>
      <code>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;
"dar",</code><br>
      <code>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; archive_options_create(),</code><br>
      <code>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; <span style="font-weight: bold;">&amp; stats</span>);<br>
      <br>
std::cout &lt;&lt; <span style="font-weight: bold;">stats.get_treated_str()</span>
&lt;&lt; " file(s) saved" &lt;&lt; std::endl;<br>
std::cout &lt;&lt; <span style="font-weight: bold;">stats.get_errored_str()</span>
&lt;&lt; " file(s) failed to backup" &lt;&lt; std::endl;<br>
std::cout &lt;&lt; <span style="font-weight: bold;">stats.get_ea_treated_str()</span>
&lt;&lt; " Extended Attributes saved" &lt;&lt; std::endl;<br>
      </code></div>
      </td>
    </tr>
  </tbody>
</table>
<br>
<br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">
      <h3>6.3 - Archive creation options<br>
      </h3>
      <div style="text-align: justify;">in the previous example, we
have created an object of class libdar::archive_options_create and
passed it on-fly to the archive constructor without modifying it, thus
we used the default options for th void set_selection(const mask &amp;
selection);is operations. But <span style="text-decoration: underline; font-weight: bold;">a lot</span>
of options are available, each one can be modified by a specific
method, you will quite never use all of them. Follows a subset of the
available options, we won't details but you can refer the doxygen
documentation of <span style="font-weight: bold;">class
libdar::archive_options_create</span> for more information.<br>
      </div>
      <ul>
        <li><code>void <span style="font-weight: bold;">set_reference</span>(<span style="font-weight: bold;">std::shared_ptr&lt;archive&gt; ref_arch</span>)</code></li>
        <li><code>void <span style="font-weight: bold;">set_selection</span>(const
          <span style="font-weight: bold;">mask</span> &amp; selection)</code></li>
        <li><code>void <span style="font-weight: bold;">set_subtree</span>(const
          <span style="font-weight: bold;">mask</span> &amp; subtree)</code></li>
        <li><code>void <span style="font-weight: bold;">set_allow_over</span>(bool
allow_over)</code></li>
        <li><code>void <span style="font-weight: bold;">set_warn_over</span>(bool
warn_over) <br>
          </code></li>
        <li><code>void <span style="font-weight: bold;">set_info_details</span>(bool
info_details) <br>
          </code></li>
        <li><code>void <span style="font-weight: bold;">set_display_treated</span>(bool
display_treated, bool only_dir) <br>
          </code></li>
        <li><code>void <span style="font-weight: bold;">set_display_skipped</span>(bool
display_skipped)</code></li>
        <li><code>void <span style="font-weight: bold;">set_display_finished</span>(bool
display_finished) <br>
          </code></li>
        <li><code>void <span style="font-weight: bold;">set_pause</span>(const
          <span style="font-weight: bold;">infinint</span> &amp; pause)
          <br>
          </code></li>
        <li><code>void <span style="font-weight: bold;">set_empty_dir</span>(bool
empty_dir)</code></li>
        <li><code>void <span style="font-weight: bold;">set_compression</span>(<span style="font-weight: bold;">compression</span> compr_algo)</code></li>
        <li><code>void <span style="font-weight: bold;">set_compression_level</span>(<span style="font-weight: bold;">U_I </span>compression_level)</code></li>
        <li><code>void <span style="font-weight: bold;">set_slicing</span>(const
          <span style="font-weight: bold;">infinint</span> &amp;
file_size, const <span style="font-weight: bold;">infinint</span>
&amp; first_file_size)</code></li>
        <li><code>void <span style="font-weight: bold;">set_ea_mask</span>(const
          <span style="font-weight: bold;">mask</span> &amp; ea_mask)<br>
          </code></li>
        <li><code>void <span style="font-weight: bold;">set_execute</span>(const
std::string &amp; execute) <br>
          </code></li>
        <li><code>void <span style="font-weight: bold;">set_crypto_algo</span>(<span style="font-weight: bold;">crypto_algo </span>crypto)</code></li>
        <li><code>void <span style="font-weight: bold;">set_crypto_pass</span>(const
          <span style="font-weight: bold;">secu_string</span> &amp;
pass)</code></li>
        <li><code>void <span style="font-weight: bold;">set_compr_mask</span>(const
          <span style="font-weight: bold;">mask</span> &amp;
compr_mask);</code></li>
        <li><code>void <span style="font-weight: bold;">set_min_compr_size</span>(const
          <span style="font-weight: bold;">infinint</span> &amp;
min_compr_size)</code></li>
        <li><code>void <span style="font-weight: bold;">set_nodump</span>(bool
nodump)</code></li>
        <li><code>void <span style="font-weight: bold;">set_exclude_by_ea</span>(const
std::string &amp; ea_name)</code></li>
        <li><code>void <span style="font-weight: bold;">set_what_to_check</span>(<span style="font-weight: bold;">comparison_fields</span> what_to_check)</code></li>
        <li><code>void <span style="font-weight: bold;">set_hourshift</span>(const
          <span style="font-weight: bold;">infinint</span> &amp;
hourshift)</code></li>
        <li><code>void <span style="font-weight: bold;">set_empty</span>(bool
empty) <br>
          </code></li>
        <li><code>void <span style="font-weight: bold;">set_alter_atime</span>(bool
alter_atime)</code></li>
        <li><code>void <span style="font-weight: bold;">set_furtive_read_mode</span>(bool
furtive_read)</code></li>
        <li><code>void <span style="font-weight: bold;">set_same_fs</span>(bool
same_fs) <br>
          </code></li>
        <li><code>void <span style="font-weight: bold;">set_snapshot</span>(bool
snapshot) <br>
          </code></li>
        <li><code>void <span style="font-weight: bold;">set_cache_directory_tagging</span>(bool
cache_directory_tagging) <br>
          </code></li>
        <li><code>void <span style="font-weight: bold;">set_fixed_date</span>(const
          <span style="font-weight: bold;">infinint</span> &amp;
fixed_date)</code></li>
        <li><code>void <span style="font-weight: bold;">set_slice_permission</span>(const
std::string &amp; slice_permission)</code></li>
        <li><code>void <span style="font-weight: bold;">set_slice_user_ownership</span>(const
std::string &amp; slice_user_ownership) <br>
          </code></li>
        <li><code>void <span style="font-weight: bold;">set_slice_group_ownership</span>(const
std::string &amp; slice_group_ownership)</code></li>
        <li><code>void <span style="font-weight: bold;">set_retry_on_change</span>(const
          <span style="font-weight: bold;">infinint</span> &amp;
count_max_per_file, const <span style="font-weight: bold;">infinint</span>
&amp; global_max_byte_overhead)</code></li>
        <li><code>void <span style="font-weight: bold;">set_security_check</span>(bool
check) <br>
          </code></li>
        <li><code>void<span style="font-weight: bold;"> set_user_comment</span>(const
std::string &amp; comment) <br>
          </code></li>
        <li><code>void <span style="font-weight: bold;">set_hash_algo</span>(hash_algo
hash)</code></li>
        <li><code>void <span style="font-weight: bold;">set_slice_min_digits</span>(<span style="font-weight: bold;">infinint</span> val) <br>
          </code></li>
        <li><code>void <span style="font-weight: bold;">set_backup_hook</span>(const
std::string &amp; execute, const <span style="font-weight: bold;">mask</span>
&amp; which_files);</code></li>
        <li><code>void <span style="font-weight: bold;">set_delta_diff</span>(bool
val)</code></li>
        <li><code>void <span style="font-weight: bold;">set_delta_signature</span>(bool
val) <br>
          </code></li>
        <li><code>void <span style="font-weight: bold;">set_delta_mask</span>(const
          <span style="font-weight: bold;">mask</span> &amp; delta_mask)</code><br>
        </li>
      </ul>
First you may have find some strange types in arguments, we will
briefly explain how to set them:<br>
      <ul>
        <li><span style="font-weight: bold;">std::shared_ptr&lt;archive&gt;</span>
C++11 shared smart-pointer to an existing archive object. We will see
how to use it next when performing differential backup<br>
          <span style="font-weight: bold;"></span></li>
        <li><span style="font-weight: bold;">infinint</span> can be set
from an <span style="font-weight: bold;">classical unsigned int</span>,
unsigned long or other unsigned integer type</li>
        <li><span style="font-weight: bold;">mask</span> is a bit more
complex, we will see how to use it in a
specific paragraph of this tutorial</li>
        <li><span style="font-weight: bold;">compression</span> is an
enumeration with values like <br>
        </li>
        <ul>
          <li><code>libdar::compression::<span style="font-weight: bold;">gzip</span></code></li>
          <li><code>libdar::compression::<span style="font-weight: bold;">bzip2</span></code></li>
          <li><code>libdar::compression::<span style="font-weight: bold;">xz</span></code></li>
          <li><code>libdar::compression:<span style="font-weight: bold;">lzo</span></code></li>
        </ul>
        <li><span style="font-weight: bold;">U_I </span>is to be
considered an <span style="font-weight: bold;">unsigned int</span></li>
        <li><span style="font-weight: bold;">crypto_algo</span> is also
an enumeration with values like</li>
        <ul>
          <li><code>libdar::crypto_algo::<span style="font-weight: bold;">scrambling</span></code></li>
          <li><code>libdar::crypto_algo::<span style="font-weight: bold;">blowfish</span></code></li>
          <li><code>libdar::crypto_algo::<span style="font-weight: bold;">aes256</span></code></li>
          <li><code>libdar::crypto_algo::<span style="font-weight: bold;">twofish256</span></code></li>
          <li><code>libdar::crypto_algo::<span style="font-weight: bold;">serpent256</span></code></li>
          <li><code>libdar::crypto_algo::<span style="font-weight: bold;">camellia256</span></code></li>
        </ul>
        <li><span style="font-weight: bold;">secu_string</span> is a
class securely storing password and sensible cryptographic information.
It can be setup from a char* or from a filedescriptor. its main
constructor is:<br>
        </li>
        <ul>
          <li>secu_string(<span style="font-weight: bold;">const char*</span>
ptr, U_I <span style="font-weight: bold;">size</span>)</li>
        </ul>
        <li><span style="font-weight: bold;">comparison_fields</span>
is an enumeration with values like</li>
        <ul>
          <li><code>libdar::comparison_fields::<span style="font-weight: bold;">cf_all</span></code></li>
          <li><code>libdar::comparison_fields::<span style="font-weight: bold;">cf_ignore_owner</span></code></li>
          <li><code>libdar::comparison_fields::<span style="font-weight: bold;">cf_mtime</span></code></li>
          <li><code>libdar::comparison_fields::<span style="font-weight: bold;">cf_inode_type</span></code></li>
        </ul>
      </ul>
      </td>
    </tr>
  </tbody>
</table>
<br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204); width: 50%;">
      <div style="margin-left: 40px;"><code><span style="font-weight: bold;"></span>libdar::archive_options_create <span style="font-weight: bold;">opt</span>;<br>
      <br>
      <span style="font-weight: bold;">opt</span>.set_allow_over(false);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// forbids slice overwriting<br>
      <span style="font-weight: bold;">opt</span>.set_display_finished(true);&nbsp;
// show a summary after each completed directory<br>
      <span style="font-weight: bold;">opt</span>.set_slicing(1024000,
2000);&nbsp; // slices of 1000 kiB initial slice of 2000 bytes<br>
      <span style="font-weight: bold;">opt</span>.set_pause(2);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// pause every two slices<br>
      <span style="font-weight: bold;">opt</span>.set_execute("echo
slice %N completed"); // command executed after each slice<br>
      <span style="font-weight: bold;">opt</span>.set_crypto_algo(libdar::crypto_algo::aes256);<br>
      <br>
      </code><code>&nbsp;// providing an empty secu_string leads dar
interactively ask the passphrase in a secure manner</code><br>
      <code><span style="font-weight: bold;">opt</span>.set_crypto_pass(secu_string());
      <br>
&nbsp;// this previous call is useless as en empty secu_string is the
default<br>
&nbsp;// though one could have setup a secu_string from a std::string
this way:<br>
std::string my_pass("hello world!");<br>
libdar::secu_string my_secupass(my_pass.c_str(), my_pass.size());<br>
      <span style="font-weight: bold;">opt</span>.set_crypto_pass(my_secupass);<br>
      <br>
      <span style="font-weight: bold;">opt</span>.set_compression(libdar::compression::xz);<br>
      <span style="font-weight: bold;">opt</span>.set_compression_level(9);&nbsp;&nbsp;
// this is the default<br>
      <span style="font-weight: bold;">opt</span>.set_min_compr_size(10240);&nbsp;
// not trying compressing file smaller than 10 kiB<br>
      <span style="font-weight: bold;"></span></code><code><br>
libdar::archive my_first_backup(nullptr,</code><br>
      <code>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; "/home/me",</code><br>
      <code>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; "/tmp",</code><br>
      <code>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;
"first_backup",</code><br>
      <code>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;
"dar",</code><br>
      <code>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; <span style="font-weight: bold;">opt</span>,</code><br>
      <code>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; nullptr);<br>
      </code></div>
      </td>
    </tr>
  </tbody>
</table>
<br>
<table style="text-align: left; width: 90%;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;"> Of course, you can use both <span style="font-weight: bold;">libdar::statistics</span> and <span style="font-weight: bold;">libdar::archive_options_create</span> at
the same time.<br>
      <br>
      <h2>7 - Creating a differential or incremental backup</h2>
      <div style="text-align: justify;">Maybe you have guessed?
Compared to the previous operation (full backup) doing an differential
or incremental backup will only ask to open in read-mode an existing
archive and pass this object as argument of class
archive_options_create::set_reference() seen just above.<br>
      <br>
The read-only constructor for class archive is the following:<br>
      <code><br>
      <span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; archive(const
std::shared_ptr&lt;user_interaction&gt; &amp; dialog,</span><br style="font-weight: bold;">
      <span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const path &amp; chem,</span><br style="font-weight: bold;">
      <span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const std::string &amp; basename,</span><br style="font-weight: bold;">
      <span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const std::string &amp; extension,</span><br style="font-weight: bold;">
      <span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const archive_options_read &amp; options);</span></code><br>
      <br>
same as before:<br>
      <ul>
        <li><span style="font-weight: bold;">dialog</span> can be set
to a <span style="font-weight: bold;">null pointer</span>, we will see
later on how to play with user_interaction class</li>
        <li><span style="font-weight: bold;">chem</span> is the path
leading to the archive to read, it can be provided as a <span style="font-weight: bold;">std::string</span></li>
        <li><span style="font-weight: bold;">basename</span> is the
archive basename to read</li>
        <li><span style="font-weight: bold;">extension</span> should be
          <span style="font-weight: bold;">"dar"</span> unless you want
to confuse people</li>
        <li><span style="font-weight: bold;">options</span> can be set
to an empty object for default options, we will see this class in more
details with archive listing</li>
      </ul>
      </div>
      </td>
    </tr>
  </tbody>
</table>
<br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204); width: 50%;">
      <div style="margin-left: 40px;"><code><span style="font-weight: bold;"></span>&nbsp; // first we open the
previously created archive in read mode:<br>
      <br>
std::shared_ptr&lt;libdar::archive&gt; <span style="font-weight: bold;">ref_archive</span>(<span style="font-weight: bold;">new</span> libdar::archive(nullptr,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"/home/me",<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"first_backup",<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"dar",<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp; &nbsp; &nbsp; archive_create_options_read()));<br>
      <br>
&nbsp; // here we dynamically allocated the object to be able to setup<br>
&nbsp; // a shared_ptr in order to passed it to <br>
&nbsp; // the archive_options_create::set_reference() method:<br>
      <br>
      </code><code>libdar::archive_options_create <span style="font-weight: bold;">opt</span>;</code><code><br>
      <span style="font-weight: bold;">opt</span>.set_reference(<span style="font-weight: bold;">ref_archive</span>);</code><code><br>
      <span style="font-weight: bold;"></span></code><code><br>
libdar::archive my_second_backup(nullptr,</code><br>
      <code>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; "/home/me",</code><br>
      <code>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; "/tmp",</code><br>
      <code>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;
"diff_backup",</code><br>
      <code>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;
"dar",</code><br>
      <code>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; <span style="font-weight: bold;">opt</span>,</code><br>
      <code>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; nullptr);<br>
      </code></div>
      </td>
    </tr>
  </tbody>
</table>
<br>
<table style="text-align: left; width: 90%;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">creating a
incremental backup is exactly the same, the difference is the nature of
the archive of reference. We used to describe a differential backup
one that has a full backup as reference, while an incremental backup
has another incremental or differential backup as reference (not a full
backup).<br>
      <br>
      <h2>8 - Archive listing</h2>
Archive listing operation consist of the creation of an archive object
in read-mode as we just did above and invoking a method on that newly
object to see all or a subdirectory content of the archive. Before
looking at the listing method let's zoom on the class
libdar::archive_create_options_read we just skip over previously.<br>
      <br>
      <h3>8.1 - Archive reading options</h3>
&nbsp;The same as the class archive_options_create detailed above, the
class archive_options_read has a constructor without argument that sets
the different options to their default value. You can change them one
by one by mean of specific methods. The most usual ones are:<br>
      <ul>
        <li>void <span style="font-weight: bold;">set_execute</span>(const
std::string &amp; execute)</li>
        <li>void <span style="font-weight: bold;">set_info_details</span>(bool
info_details)</li>
        <li>void <span style="font-weight: bold;">set_sequential_read</span>(bool
val)</li>
        <li>void <span style="font-weight: bold;">set_slice_min_digits</span>(infinint
val)</li>
      </ul>
set_execute() has runs a command before reading a new slice of the
archive. See API reference documentation for details. You will meet
that class in order to test an archive, compare an archive with
filesystem, isolate an archive and repaire an archive.<br>
      <br>
      <h3>8.2 - Listing methods</h3>
There is several way to read an given archive contents:<br>
      <ul>
        <li><code>void <span style="font-weight: bold;">op_listing</span>(archive_listing_callback
          <span style="font-weight: bold;">callback</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
void *<span style="font-weight: bold;">context</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const archive_options_listing &amp; <span style="font-weight: bold;">options</span>)
const;</code></li>
        <li><code>bool <span style="font-weight: bold;">get_children_of</span>(archive_listing_callback
          <span style="font-weight: bold;">callback</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
void *<span style="font-weight: bold;">context</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const std::string &amp; <span style="font-weight: bold;">dir</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
bool <span style="font-weight: bold;">fetch_ea</span> = false);</code></li>
        <li><code>const std::vector&lt;list_entry&gt; <span style="font-weight: bold;">get_children_in_table</span>(const
std::string &amp; dir, bool <span style="font-weight: bold;">fetch_ea</span>
= false) const</code></li>
      </ul>
      <span style="font-weight: bold;">archive::op_listing() </span>makes
use of a callback function that will be called in turn for each entry
of the archive even special entries that flag the end of a directory.<br>
      <span style="font-weight: bold;">archive::get_children_of() </span>use
the same callback but only for the different entries of a given
directory, that has to exist in the archive of course. It returns false
      <br>
      <span style="font-weight: bold;">archive::get_children_in_table()</span>
is like the previous but return a vector if object <span style="font-weight: bold;">libdar::list_entry</span> that provide
detailed information about each entry<br>
      <br>
      <span style="font-weight: bold;">For the two first methods</span>
you have to define a callback function of the following form<br>
      <br>
      <div style="margin-left: 40px;"><code><span style="font-weight: bold;">void (*)(const std::string &amp; the_path,</span><br style="font-weight: bold;">
      <span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const list_entry &amp; entry,</span><br style="font-weight: bold;">
      <span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
void *context);</span></code><br>
      </div>
      <br>
This callback will receive as argument the full path of the object, an <span style="font-weight: bold;">libdar::list_entry</span> object providing
much details on it and the "context" value passed as argument of <span style="font-weight: bold;">archive::op_listing()</span> or <span style="font-weight: bold;">archive::get_children_of()<br>
      <span style="font-weight: bold;"><br>
      </span></span>Last point to see before going forward with an
example is this <span style="font-weight: bold;">libdar::list_entry </span>class,
but it has so many calls that we let you refer to the API reference, we
will use and comment some of them in the examples.<br>
      <span style="font-weight: bold;"></span><br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204); width: 50%;">
      <div style="margin-left: 40px;">&nbsp; <code><span style="font-weight: bold;"></span></code><code> // we first create a
read-mode archive object that will be used in the three following
examples<br>
&nbsp;// we will also illustrate the use of libdar::archive_options_read<br>
      <br>
libdar::archive_options_read opt;<br>
      <br>
opt.set_info_details(true);<br>
opt.set_execute("echo 'about to read slice %p/%b.%N.%e with context
%c'");<br>
      <br>
libdar::archive <span style="font-weight: bold;">my_backup</span>(nullptr,&nbsp;&nbsp;
// this is user_interaction we will see further<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</code><code>"/home/me",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"diff_backup",<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"dar",<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
opt); <br>
      </code><code><br>
      <br>
&nbsp; // we will also need a backup function for the two first methods<br>
&nbsp; // let's define it:<br>
      <br>
void <span style="font-weight: bold;">my_listing_callback</span>(const
std::string &amp; the_path,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const libdar::list_entry &amp; entry,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
void *context)<br>
{<br>
&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; the_path;<br>
&nbsp;&nbsp;&nbsp; if(entry.is_dir())<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; " is a
directory";<br>
&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; " with permission " &lt;&lt;
entry.get_perm();<br>
&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; " located in slices " &lt;&lt;
entry.get_slices().display();<br>
&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; std::endl;<br>
&nbsp;&nbsp;&nbsp;&nbsp; // yep, we do not need context, this<br>
&nbsp;&nbsp;&nbsp;&nbsp; // might be different in some other <br>
&nbsp;&nbsp;&nbsp;&nbsp; // "context" :-)<br>
}<br>
      </code></div>
      </td>
    </tr>
  </tbody>
</table>
<br>
<br>
<table style="text-align: left; width: 90%;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">
      <div style="text-align: justify;">
      <h3>8.3 - archive listing using archive::op_listing()</h3>
      </div>
      </td>
    </tr>
  </tbody>
</table>
<br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204); width: 50%;">
      <div style="margin-left: 40px;"><code>&nbsp; // first
possibility: we can pass nullptr as callback function to
archive::op_listing, all will be displayed in stdout<br>
      <br>
      <span style="font-weight: bold;">my_backup</span>.op_listing(<span style="font-weight: bold;">nullptr</span>, // no callback function<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nullptr, // we don't
care of context here<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
archive_options_listing()) // and use default listing options<br>
      <br>
      <br>
      </code><code> </code></div>
      </td>
    </tr>
  </tbody>
</table>
<br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204); width: 50%;">
      <div style="margin-left: 40px;"><code>&nbsp; // second
possibility: we use the callback defined above<br>
      <br>
      <span style="font-weight: bold;">my_backup</span>.op_listing(<span style="font-weight: bold;">my_listing_callback</span>,<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nullptr, // we still
don't care of context here<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
archive_options_listing()) // and still se default listing options<br>
      <br>
      </code><code> </code></div>
      </td>
    </tr>
  </tbody>
</table>
<br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204); width: 50%;">
      <div style="margin-left: 40px;"><code>&nbsp; // in complement of
both previous variant we can of course set non default listing options<br>
      <br>
libdar::archive_options_listing <span style="font-weight: bold;">opt</span>;<br>
      <br>
      <span style="font-weight: bold;">opt</span>.set_filter_unsaved(true);
// skip entry that have not been saved since the archive of reference<br>
      <span style="font-weight: bold;">opt</span>.set_slice_location(true);
// necessary if we want to have slicing information available in the
callback function<br>
opt.set_fetch_ea(false);&nbsp; // this is the default. Set it to true
if you want to use list_entry::get_ea_reset_read()/get_ea_next_read()<br>
      <br>
      <span style="font-weight: bold;">my_backup</span>.op_listing(my_listing_callback,<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nullptr, // we still
don't care of context here<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="font-weight: bold;">opt</span>) // and still se default listing
options<br>
      <br>
      </code><code> </code></div>
      </td>
    </tr>
  </tbody>
</table>
<br>
<br>
<table style="text-align: left; width: 90%;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">
      <div style="text-align: justify;">
      <h3>8.4 - archive listing using archive::get_children_of()</h3>
      </div>
      </td>
    </tr>
  </tbody>
</table>
<br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204); width: 50%;">
      <div style="margin-left: 40px;"><code>&nbsp; // With this method
we only list one directory<br>
      <br>
my_backup.<span style="font-weight: bold;">get_children_of</span>(my_listing_callback,<br>
&nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nullptr,&nbsp; // we
still don't care of context here<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="font-weight: bold;">"",</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// we read the root directory of the archive<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
true); &nbsp;&nbsp; // and ask for EA retrieval, but as we do not<br>
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// use list_entry::get_ea_read_next() in the<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// callback this is just wasting CPU and memory<br>
      <br>
or course if you have a subdirectory /home/me/.gnupg/private-keys-v1.d
in your home directory and you want to check how it is saved in the
archive, as we defined the root of the backup as /home/me and as you
always have to pass a relative path (no leeding /) you could do that by
calling the following:<br>
      <br>
      </code><code>my_backup.<span style="font-weight: bold;">get_children_of</span>(my_listing_callback,<br>
&nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nullptr,<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="font-weight: bold;">"</span></code><code><span style="font-weight: bold;">.gnupg/private-keys-v1.d"</span>);</code><code>&nbsp;&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code><br>
      <br>
      </code><code> </code></div>
      </td>
    </tr>
  </tbody>
</table>
<br>
<br>
<table style="text-align: left; width: 90%;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">
      <div style="text-align: justify;">
      <h3>8.5 - archive listing using archive::get_children_in_table()</h3>
      </div>
      </td>
    </tr>
  </tbody>
</table>
<br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204); width: 50%;">
      <div style="margin-left: 40px;"><code></code><code> // still
listing a single directory but this time without callback function:<br>
      <br>
my_backup.<span style="font-weight: bold;">init_catalogue</span>(); //
necessary to fill read the whole catalogue in memory<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// in particular if archive has been opened in sequential read mode<br>
      <br>
std::vector&lt;libdar::list_entry&gt; result = my_backup.<span style="font-weight: bold;">get_children_in_table</span>(</code><code>"</code><code>.gnupg/private-keys-v1.d");<br>
      <br>
// now reading the std::vector<br>
      <br>
std::vector&lt;libdar::list_entry&gt;::iterator it = result.begin();<br>
while(it != result.end())<br>
{<br>
      </code><code>&nbsp;&nbsp; if(it-&gt;is_dir())<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; " is a
directory";<br>
&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; " with permission " &lt;&lt;
it-&gt;get_perm();<br>
&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; " located in slices " &lt;&lt;
it-&gt;get_slices().display();<br>
&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; std::endl;</code><code><br>
}<br>
      </code><code><br>
      </code><code> </code></div>
      </td>
    </tr>
  </tbody>
</table>
<br>
<br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;"> <span style="font-weight: bold;"></span> <span style="font-weight: bold;"></span>
      <h2>9 - Testing an archive<br>
      </h2>
      <div style="text-align: justify;">As seen for listing operation
we assume a archive object has been create in read mode. Testing the
coherence of the relative archive files on disk is done by calling the <span style="font-weight: bold;">libdar::op_test</span> method:<br>
      </div>
      <br>
      <code style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
statistics op_test(const archive_options_test &amp; options,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
statistics * progressive_report);</code><br>
      <br>
      <div style="text-align: justify;">You may recognize the
libdar::statistics type we saw for archive creation. It is present as
argument and the provided libdar::statistics object can be read during
the whole testing operation by another thread. But if you just want the
to know the result, you'd better just use the returned value as it
makes the operation quicker due to the absence of multithread
management.<br>
      </div>
      </td>
    </tr>
  </tbody>
</table>
<code></code><br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204); width: 50%;"><code><br>
      </code>
      <div style="margin-left: 40px;"><code>&nbsp;&nbsp; // for the
exercice, we will change some default options:<br>
      <br>
      </code><code>archive_options_test <span style="font-weight: bold;">opt</span>;</code><br>
      <code><span style="font-weight: bold;">opt</span>.set_info_details(true);
// to have a verbose output</code><br>
      <code></code><br>
      <code>libdar::statistics <span style="font-weight: bold;">stats</span>;</code><br>
      <code><span style="font-weight: bold;">stats</span> = my_backup.<span class="el">op_test</span>(<span class="el"></span>nullptr,&nbsp;&nbsp;
// still the user_interaction we will see further</code><br>
      <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="font-weight: bold;">opt</span>; &nbsp; &nbsp; &nbsp;
// the non default options set above</code><code></code><br>
      <code>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
nullptr);&nbsp; // we will just use the returned value</code><br>
      <code></code><br>
      <code></code><code>std::cout &lt;&lt; <span style="font-weight: bold;">stats</span>.get_treated_str() &lt;&lt; "
file(s) tested" &lt;&lt; std::endl;</code><br>
      <code>std::cout &lt;&lt; <span style="font-weight: bold;">stats</span>.get_errored_str()
&lt;&lt; " file(s) with errors" &lt;&lt; std::endl;</code><br>
      <code>std::cout &lt;&lt; <span style="font-weight: bold;">stats</span>.get_ea_treated_str()
&lt;&lt; " Extended Attributes tested" &lt;&lt; std::endl;</code><code></code><br>
      </div>
      <br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;"> <span style="font-weight: bold;"></span> <span style="font-weight: bold;"></span>
      <h2>10 - Comparing an archive<br>
      </h2>
      <div style="text-align: justify;">As simple as previously, but
using the <span style="font-weight: bold;">archive::op_diff </span>method:<br>
      </div>
      <br>
      <code style="font-weight: bold;">&nbsp; &nbsp; &nbsp; &nbsp;
statistics op_diff(const path &amp; fs_root,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const archive_options_diff &amp; options,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
statistics * progressive_report);</code><br>
      <code style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      </code><br>
      <br>
      <div style="text-align: justify;">Over the type of the option
field, you see the <span style="font-weight: bold;">fs_root </span>argument
which define which directory of the filesystem to compare the archive to<br>
      </div>
      </td>
    </tr>
  </tbody>
</table>
<code></code><br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204); width: 50%;"><code><br>
      </code>
      <div style="margin-left: 40px;"><code>&nbsp;&nbsp; // for the
exercice, we will change some default options:<br>
      <br>
      </code><code>archive_options_diff <span style="font-weight: bold;">opt</span>;</code><br>
      <code> <span style="font-weight: bold;">opt</span>.set_info_details(true);
// to have a verbose output<br>
      <span style="font-weight: bold;">opt</span>.set_what_to_check(libdar::comparison_fields::cf_ignore_owner);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // this option above will consider equal
two files which<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // only change due to user or group
ownership difference<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // by default any difference will be
considered a difference<br>
      </code> <code></code><code></code><br>
      <span style="font-weight: bold;"></span><code><span style="font-weight: bold;"></span><span style="font-family: mon; font-weight: bold;">(void)</span><span style="font-weight: bold;"> </span>my_backup.<span class="el">op_diff</span>(<span class="el"></span><span style="font-weight: bold;">"/home/me"</span>,</code><br>
      <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="font-weight: bold;">opt</span>; &nbsp; &nbsp; &nbsp;
// the non default options set above</code><code></code><br>
      <code>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
nullptr);&nbsp; // not using it for this example</code><br>
      <code></code><code></code><code></code><br>
      </div>
      <br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;"> <span style="font-weight: bold;"></span> <span style="font-weight: bold;"></span>
      <h2>11 - Isolating an archive<br>
      </h2>
      <div style="text-align: justify;">As simple as previously, but
using the <span style="font-weight: bold;">archive::op_isolate </span>method:<br>
      </div>
      <code style="font-weight: bold;"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; void op_isolate(const path
&amp;sauv_path,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const std::string &amp; filename,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const std::string &amp; extension,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const archive_options_isolate &amp; options);<br>
      </code><code style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      </code><br>
      <div style="text-align: justify;">You will find similitudes with
the archive creation though here this is not a constructor<br>
      <br>
      <span style="font-weight: bold;">sauv_path </span>is the
directory where to create the isolated version of the current archive<br>
      <span style="font-weight: bold;">filename</span> is the archive
basename to create<br>
      <span style="font-weight: bold;">extension</span> should still be
"dar" here too<br>
      <span style="font-weight: bold;">options</span> are options for
isolation like slicing, compression, encryption similar to the
archive_options_create class we saw at the beginning of this tutorial<br>
      </div>
      </td>
    </tr>
  </tbody>
</table>
<code></code><br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204); width: 50%;"><code></code>
      <div style="margin-left: 40px;"><code>&nbsp;&nbsp; // for the
exercice, we will change some default options:<br>
      <br>
      </code><code>archive_options_isolate <span style="font-weight: bold;">opt</span>;</code><br>
      <code> <span style="font-weight: bold;">opt</span>.set_warn_over(false);&nbsp;
      <br>
&nbsp;&nbsp; // by default overwriting is allowed by a warning is
issued first<br>
&nbsp;&nbsp; // here overwriting will take place without warning<br>
      </code><code><br>
      <span style="font-weight: bold;">opt</span>.set_compression(libdar::compression::gzip);<br>
      <span style="font-weight: bold;">opt</span>.set_compression_level(9);&nbsp;&nbsp;
// this is the default<br>
      <span style="font-weight: bold;">opt</span>.set_min_compr_size(10240);&nbsp;
// not trying compressing file smaller than 10 kiB</code><br>
      <code></code><code></code><br>
      <span style="font-weight: bold;"></span><code><span style="font-weight: bold;"></span><span style="font-family: mon; font-weight: bold;"></span><span style="font-weight: bold;"></span>my_backup.<span class="el">op_isolate</span>(<span class="el"></span>"/tmp"<span style="font-weight: bold;">,</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"CAT_diff_backup",<br>
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "dar",<br>
      </code><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <span style="font-weight: bold;">opt</span>); // the non default
options set above</code><code></code><br>
&nbsp; <code></code><span style="font-family: monospace;"><br>
&nbsp;&nbsp; // have you noted? There is no libdar statistics field
returned nor as argument.</span><code></code><br>
      </div>
      </td>
    </tr>
  </tbody>
</table>
<br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="2" cellspacing="2">
<tbody><tr><td style="vertical-align: top;"> <span style="font-weight: bold;"></span> <span style="font-weight: bold;"></span>
      <h2>12 - Restoring files from an archive<br>
      </h2>
      <div style="text-align: justify;">Quite as simple as previously, here we use the <span style="font-weight: bold;">archive::op_extract </span>method:<br>
      </div>
      <code style="font-weight: bold;"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; statistics op_extract(const path &amp;fs_root,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const archive_options_extract &amp; options,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
statistics *progressive_report);<br>
<br>
<br>
      </code><code style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      </code><br>
      <div style="text-align: justify;"><span style="font-weight: bold;">fs_root</span> is the directory under which to restore the files and directory<br>
<span style="font-weight: bold;">options</span> defines how and what to restore<br>
<span style="font-weight: bold;">progressive_report</span> has already been seen several time previously<br>
      </div>
      </td></tr></tbody>
</table>
<code></code><br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204); width: 50%;"><code></code>
      <div style="margin-left: 40px;"><code>&nbsp;&nbsp; // as we still do not have seen masks, we will restore all files contained in the backup<br>
&nbsp;&nbsp; // such mask would be provided to the <br>
&nbsp;&nbsp; // archive_options_extract::set_selection() and/or <br>
&nbsp;&nbsp; // to the archive_options_extract::set_subtree() methods<br>
&nbsp;&nbsp; // to precisely define what files to restore<br>
      <br>
archive_options_extract <span style="font-weight: bold;">opt</span>;<br>
      <br>
      <span style="font-weight: bold;">opt</span>.set_dirty_behavior(false, false); // dirty files are not restored<br>
      <br>
(void) my_backup.<span style="font-weight: bold;">op_extract</span>("/home/me/my_home_copy",<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <span style="font-weight: bold;">opt</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
nullptr); // we have seen previously how to use statistics<br>
&nbsp; </code><span style="font-family: monospace;"></span><code></code><br>
      </div>
      </td>
    </tr>
  </tbody>
</table>
<br>
<br>

<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="2" cellspacing="2">

<tbody><tr><td style="vertical-align: top;"> <span style="font-weight: bold;"></span> <span style="font-weight: bold;"></span>
      <h2>13 - Merging archives<br>
      </h2>
      <div style="text-align: justify;">Here
we will need two archive objects open in read-mode and we will invoke a
specific archive constructor passing these two objects as argument,
once the constructor will have completed the merging operation will be
done:<br>
      </div>
      <code style="font-weight: bold;"><br><br>
&nbsp; &nbsp; &nbsp; &nbsp; archive(const std::shared_ptr&lt;user_interaction&gt; &amp; dialog,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; const path &amp; sauv_path,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
std::shared_ptr&lt;archive&gt; ref_arch1,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; const std::string &amp; filename,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; const std::string &amp; extension,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const archive_options_merge &amp; options,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; statistics * progressive_report);<br>
      </code><code style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      </code><br>
      <div style="text-align: justify;"><span style="font-weight: bold;">dialog</span> is will still be set to null pointer for now<br>
      <span style="font-weight: bold;">sauv_path</span> is the directory where to create the resulting merging archive<br>
      <span style="font-weight: bold;">ref_arch1</span> is the first (and mandatory) archive, the second is optional and may be given to the <span style="font-weight: bold;">options</span> argument<br>
      <span style="font-weight: bold;">filename</span> is the resulting archive basename<br>
      <span style="font-weight: bold;">extension</span> as always should be set to "dar"<br>
      <span style="font-weight: bold;">options</span> is a set of optional parameters<br>
      <span style="font-weight: bold;">progressive_report </span>is as seen above the ability to have another thread  showing progression info during the operation<br>
</div>
      </td></tr></tbody>
</table>

<code></code><br>

<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="1" cellpadding="2" cellspacing="2">

  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204); width: 50%;"><code></code>
      <div style="margin-left: 40px;"><code>&nbsp; // assuming you have two backups: <br>
&nbsp; // the first is /tmp/home_backup.*.dar<br>
&nbsp; // the second is /var/tmp/system_backup.*.dar<br>
&nbsp; // we will create /tmp/merged.*.dar as result of the merging<br>
&nbsp; // of these two backups<br>
      <br>
&nbsp; // 1 - first things first: opening the first backup<br>
      <br>
</code><code>
libdar::archive_options_read <span style="font-weight: bold;">opt</span>;<br>
      <br>
      <span style="font-weight: bold;">opt</span>.set_info_details(true);<br>
      <span style="font-weight: bold;">opt</span>.set_execute("echo 'about to read slice %p/%b.%N.%e with context
%c'");<br>
      <br>std::shared_ptr&lt;libdar::archive&gt; <span style="font-weight: bold;"><span style="font-family: monospace;">home_backup</span></span>(<span style="font-weight: bold;">new</span> libdar::archive(nullptr,&nbsp;&nbsp;
// this is user_interaction we will see further<br>&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</code><code>"/tmp",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"home_backup",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"dar",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp;
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="font-weight: bold;">opt</span>)); </code><code><br>
      <br>
&nbsp; // 2 - opening the second backup<br>
      <br>
std::shared_ptr&lt;libdar::archive&gt; <span style="font-weight: bold;">system_backup</span>(<span style="font-weight: bold;">new</span> libdar::archive(nullptr,<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"/var/tmp",<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"system_backup",<br>
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"dar",<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <span style="font-weight: bold;">opt</span>);<br>
      <br>
&nbsp; // 3 - setting up the options for merging<br>
      <br>
libdar::archive_options_merge <span style="font-weight: bold;">opt_merge</span>;<br>
      <br>
opt_merge.set_auxilliary_ref(<span style="font-weight: bold;">system_backup</span>);<br>
opt_merge.set_slicing(1048576, 0); // all slice would have 1 MiB at most<br>
opt_merge.set_compression(libdar::compression::bzip2);<br>
opt_merge.set_keep_compressed(true);<br>
opt_merge.set_user_comment("archive resulting of the merging of home_backup and system_backup");<br>
opt_merge.set_hash_algo(libdar::hash_algo::hash_sh512); // will generate on-fly hash file for each slice<br>
      <br>
&nbsp; // 4 - now performing the merging operation<br>
      <br>
libdar::archive <span style="font-weight: bold;">merged</span>(nullptr,&nbsp; // still the user_interaction we will see further<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"/tmp",<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <span style="font-weight: bold;">home_backup</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"merged",<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"dar",<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <span style="font-weight: bold;">opt_merge</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
nullptr);&nbsp; // progressive_report we don't use here<br>
      <br>
      </code><code></code><br>
      </div>
      </td>
    </tr>
  </tbody>
</table>

<br>

<br>


<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="2" cellspacing="2">


<tbody><tr><td style="vertical-align: top;"> <span style="font-weight: bold;"></span> <span style="font-weight: bold;"></span>
      <h2>14 - Decremental backup<br>
      </h2>
      <div style="text-align: justify;">Decremental
backup is an operation that from two full backups an old and a recent
one creates a backward differential backup corresponding to the old
full backup based on the new full backup. In other words, instead of
keeping two full backups, you can keep the latest and replace the
oldest by its decremental counterpart. This will save you space while
letting you restore as if you had the old full backup by restoring
first the recent backup then the decremental backup.<br>
      <br>
Creating a decremental backup is exactly the same as creating a merging
backup, you need just to set the
archive_options_merge::set_decremental_mode() before proceeding to the
merging. To avoid duplication we will just illustrate the last step of
the previous operation modified for decremental backup:<br>
</div></td></tr></tbody>
</table>


<code></code><br>


<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="1" cellpadding="2" cellspacing="2">


  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204); width: 50%;"><code></code>
      <div style="margin-left: 40px;"><code>&nbsp; // </code><code></code><code>[...]<br>
      <br>
libdar::archive_options_merge <span style="font-weight: bold;">opt_merge</span>;<br>
      <br>
&nbsp; // [...]<br><span style="font-weight: bold;">
opt_merge.set_decremental_mode(true);</span><br>
      <br>
&nbsp; // 4 - now performing the merging operation (here decremental backup)<br>
      <br>
libdar::archive merged(nullptr,&nbsp; // still the user_interaction we will see further<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"/tmp",<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
home_backup,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"merged",<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"dar",<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="font-weight: bold;">opt_merge</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
nullptr);&nbsp; // progressive_report we don't use here<br>
      <br>
      </code></div>
      </td>
    </tr>
  </tbody>
</table>


<br>


<br>


<br>



<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="2" cellspacing="2">



<tbody><tr><td style="vertical-align: top;"> <span style="font-weight: bold;"></span> <span style="font-weight: bold;"></span>
      <h2>15 - Archive repairing<br>
      </h2>
      <div style="text-align: justify;">If
an archive has been truncated due to lack of disk space and if
sequential marks (aka tape marks) had not been disable, it is possible
to rebuild sane archive beside this truncated one.<br>
      <br>
We just need to invoke a <span style="font-weight: bold;">specific libdar::archive constructor</span> which form follows:<br>
      <br>
      <code style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; archive(const std::shared_ptr&lt;user_interaction&gt; &amp; dialog,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; const path &amp; chem_src,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; const std::string &amp; basename_src,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const std::string &amp; extension_src,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const archive_options_read &amp; options_read,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; const path &amp; chem_dst,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; const std::string &amp; basename_dst,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const std::string &amp; extension_dst,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const archive_options_repair &amp; options_repair);</code><br>
      <br>
You should now be familliarized with the different types and variable
uses. As you can note, this constructor takes in charge the work to
read the damaged archive, so you won't have to do it first. As always,
this constructor will end only once the operation will have completed.<br>
      <br>
</div></td></tr></tbody>
</table>



<code></code><br>



<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="1" cellpadding="2" cellspacing="2">



  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204); width: 50%;"><code></code>
      <div style="margin-left: 40px;"><code>&nbsp; // </code><code>assuming the archive /tmp/home_backup.*.dar is damaged <br>
&nbsp; // and you want to have repaired archive as /tmp/home_backup_repaired.*.dar<br>
      <br>
libdar::archive repaired(nullptr,&nbsp;&nbsp; // still the user_interaction we have not yet seen<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"/tmp"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"home_backup",<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"dar",<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <span style="font-weight: bold;">archive_options_read()</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"/tmp",<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"home_backup_repaired",<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"dar",<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <span style="font-weight: bold;">archive_options_repair()</span>);<br>
      <br>
&nbsp; // we have not done fancy things with the two option classes, but we did above<br>
&nbsp; // enough time for you get all the necessary information from the API reference <br>
&nbsp; // documentation<br>
<br>
      </code></div>
      </td>
    </tr>
  </tbody>
</table>



<br>



<hr style="width: 100%; height: 2px;"><br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">
      <h2>16 - Looking at some details<br>
      </h2>
we have covered the different operations the class libdar::archive can be used for, still remains some concepts to details:<br>
      <ul>
        <li>user_interaction</li>
        <li>masks</li>
        <li>how to cleanly interrupt an running libdar routine</li>
        <li>how to known which compile-time feature has been activated<br>
        </li>
      </ul>
Then we will see the three other more simple classes :<br>
      <ul>
        <li>class database</li>
        <li>class libdar_slave</li>
        <li>class libdar_xform</li>
      </ul>
For now, maybe you remember that we had to initialize libdar before use, by calling <span style="font-weight: bold;">libdar::get_version()? </span>This routine also exists with arguments that will provide as its name suggests the libdar version:<br>
      <br>
      <div style="margin-left: 40px;"><code><span style="font-weight: bold;">void get_version(U_I &amp; major, U_I &amp; medium, U_I &amp; minor, bool init_libgcrypt = true);</span></code><br>
      </div>
      <br>
It is advised to use this form to fetch the libdar version major, medium and minor numbers for the following reasons:<br>
      <br>
you should check that the
library
you've dynamically linked with is compatible with the features you will
be using. The major number must be the same, for no compatibility is
assured between two libdar versions of different major numbers. While
run-time compatibility is assured between medium numbers, the medium
number must be greater or equal to the one used at compilation time to
be sure that all the features you want are available in the libdar
library you dynamically linked with. Changes between minor versions
correspond to bug fixes and is not to imply any API change, thus no
constraints is present there (just note the presence of more bugs in
lower numbers).<br>
      <br>
If you use libgcrypt beside libdar in your application you should
initialize libgcrypt and not let it be done by libdar the lastest
argument of this form should be set to false in that case. Note
that <a href="https://www.gnupg.org/documentation/manuals/gcrypt/Initializing-the-library.html#Initializing-the-library">libgcrypt
documentation</a> indicates that libgcrypt must be initialized directly
from
the application not from an intermediate library.<br>
      <br>
Follows an example of test that can be performed while initializing libdar:<ul style="text-align: justify;">
        
      </ul>
      <ul>
      </ul>
      
      
      </td>
    </tr>
  </tbody>
</table>
<br>

<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="1" cellpadding="2" cellspacing="2">

  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204); width: 50%;"><code>U_I major, medium, minor;<br>
      <br>
libdar::get_version(major, medium, minor);<br>
<br>
      </code><code> if(maj !=
libdar::LIBDAR_COMPILE_TIME_MAJOR ||<br>&nbsp;&nbsp; med &lt;
libdar::LIBDAR_COMPILE_TIME_MEDIUM)<br>
{<br>
&nbsp; &nbsp; std::cout &lt;&lt; "libdar version we link with is too old for this code" &lt;&lt; std::endl;<br>
&nbsp;&nbsp;&nbsp; // throw an exception or anything else appropriate to that condition<br>
}<br>
      <br>
      </code>
      </td>
    </tr>
  </tbody>
</table>

<br>
<table style="text-align: left; width: 90%;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">
      
      <h2>17 - checking compile-time features activation<br>
      </h2>
once we have called one of the <span style="font-style: italic;">get_version*</span>
function it is possible to access the list of features activated at
compilation
time thanks to a set of function located in the compile_time nested namespace inside libdar:<br>
</td>
    </tr>
  </tbody>
</table>
<br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204); width: 50%;"><code><br>
      <br>
void my_sample_function()<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
      </code>
      <div style="margin-left: 40px;"><code>bool ea =
libdar::compile_time::ea();<br>
bool largefile = libdar::compile_time::largefile();<br>
bool nodump = libdar::compile_time::nodump();<br>
bool special_alloc = libdar::compile_time::special_alloc();<br>
U_I bits = libdar::compile_time::bits();<br>
// bits is equal to zero for infinint,<br>
// else it is equal to 32 or 64 depending on<br>
// the compilation mode used.<br>
      <br>
bool thread = libdar::compile_time::thread_safe();<br>
bool libz = libdar::compile_time::libz();<br>
bool libbz2 = libdar::compile_time::libbz2();<br>
bool liblzo = libdar::compile_time::liblzo();<br>
bool libxz = libdar::compile_time::libxz();<br>
bool libcrypto = libdar::compile_time::libgcrypt();<br>
bool furtive_read = libdar::compile_time::furtive_read</code>();<br>
      <br>
      <span style="font-family: monospace;">/ // for details see the compile_time namespace in the API reference documentation</span><span style="font-family: monospace;"></span><br>
      </div>
      <code> </code><br>
}<br>
      <br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">
      
      
      
      <h2>18 - User Interaction</h2>
we have seen std::shared_pointer on class <span style="font-weight: bold;">libdar::user_interaction</span> previously but did not used this feature.<br>
      <br>
      <h3>18.1 - Defining your own user_interaction class</h3>
class <span style="font-weight: bold;">libdar::user_interaction</span>
defines the way libdar interact with the user during an operation, like
an archive creation, restoration, testing and so on. Only four types of
interaction are used by libdar:<br>
      <br>
      <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; void message(const std::string &amp; message);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; void pause(const std::string &amp; message);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::string get_string(const std::string &amp; message, bool echo);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; secu_string get_secu_string(const std::string &amp; message, bool echo);</code><br>
      <br>
By default an inherited class of libdar::user_interaction called
shell_interaction is used and implements these four type of exchange by
mean of text terminal:<br>
      <ul>
        <li><span style="font-weight: bold;">message()</span> sends the std::string provided by libdar to stdout</li>
        <li><span style="font-weight: bold;">pause()</span> does the same and ask for the user to press either return or escape to answer yes or no</li>
        <li><span style="font-weight: bold;">get_string()</span> reads a string from stdin</li>
        <li><span style="font-weight: bold;">get_secu_string()</span> reads a string into a secu_string object from stdin too<br>
        </li>
      </ul>
For a GUI you will probably not want stdin and stdout to be used. For
that you have the possibility to implement your own inherited class
from user_interaction. It should look like the following:<br>
      <br>
</td>
    </tr>
  </tbody>
</table>
<br>
<code></code><code></code>
<table style="width: 90%; height: 51px; text-align: left; margin-left: auto; margin-right: auto;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204);"><code></code><code>class my_user_interaction: public libdar::user_interaction<br>
{<br>
protected:<br>
&nbsp;&nbsp; &nbsp;&nbsp; // display of informational message<br>
&nbsp;&nbsp; virtual void inherited_message(const std::string &amp; message) override;<br>
      <br>
&nbsp; &nbsp; &nbsp; // display of a question and returns the answer from user as true/false <br>
&nbsp;&nbsp; virtual bool inherited_pause(const std::string &amp; message) override;<br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // display the message and returns a
string from the user, with or without display what the user typed (echo)<br>
&nbsp;&nbsp; virtual std::string inherited_get_string(const std::string &amp; message, bool echo) override; <br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // same as the previous be the user provided string is returned as secu_string <br>
&nbsp;&nbsp; virtual secu_string inherited_get_secu_string(const std::string &amp; message, bool echo) override;<br>
};<br>
</code><br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">
      <h3>18.2 - Relying on the pre-defined user_interaction_callback class<br>
      </h3>
      <div style="text-align: justify;">As an alternative to defining
your own inherited class from <span style="font-style: italic;">libdar::user_interaction</span>,
libdar provides a class called <span style="font-weight: bold; font-style: italic;">user_interaction_callback</span>
which is an implementation of the user interaction, based on callback
functions.<br>
      <br>
You will need to implement four callback functions:<br>
      <br>
      <code style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; using message_callback = void (*)(const std::string &amp;x, void *context);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; using pause_callback = bool (*)(const std::string &amp;x, void *context);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; using get_string_callback =
std::string (*)(const std::string &amp;x, bool echo, void *context);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; using
get_secu_string_callback = secu_string (*)(const std::string &amp;x,
bool echo, void *context);</code><br>
      <br>
Then you can create an libdar::user_interaction_callback object using this constructor:<br>
      <br>
      <code style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; user_interaction_callback(message_callback x_message_callback,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
pause_callback x_answer_callback,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
get_string_callback x_string_callback,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
get_secu_string_callback x_secu_string_callback,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
void *context_value);</code><br>
      <br>
Here follows an example of use:<br>
      </div>
       </td>
    </tr>
  </tbody>
</table>
<br>

<code></code><code></code>
<table style="width: 90%; height: 51px; text-align: left; margin-left: auto; margin-right: auto;" border="1" cellpadding="2" cellspacing="2">

  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204);"><code></code><code>void my_message_cb(const std::string &amp; x, void *context)<br>
{<br>
&nbsp;&nbsp;&nbsp; cout &lt;&lt; x &lt;&lt; endl;<br>
}<br>
      <br>
bool void my_pause_cb(const std::string &amp; x, void *context)<br>
{<br>
&nbsp;&nbsp; char a;<br>
      <br>
&nbsp;&nbsp; cout &lt;&lt; x &lt;&lt; endl;<br>
&nbsp;&nbsp; cin &gt;&gt; a;<br>
&nbsp;&nbsp; return a == 'y';<br>
}<br>
      <br>
std::string my_string_cb(const std::string &amp; x, bool echo, void *context)<br>
{<br>
&nbsp; // to be defined<br>
}<br>
      <br>
libdar::secu_string my_secu_string_cb(const std::string &amp; x, bool echo, void *context)<br>
{<br>
&nbsp; // to be defined<br>
}<br>
      <br>
&nbsp;&nbsp; // enventually using a context_value that will be passed to the callback of the object<br>
void *context_value = (void *)(&amp; some_datastructure);<br>
      <br>
std::shared_ptr&lt;libdar::user_interaction&gt; my_user_interaction(new libdar::user_interaction_callback(my_message_cb,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
my_pause_cb,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
my_string_cb,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
my_secu_string_cb,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
context_value));</code><br>
</td>
    </tr>
  </tbody>
</table>

<code></code><code></code><code></code><code></code><code></code><br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">
      You will also find pre-defined classes like <span style="font-weight: bold;">libdar::user_interaction_blind</span> which always says no in name of the user displays nothing and provide empty strings, as well as <span style="font-weight: bold;">libdar::shell_interaction_emulator</span>
which given a user_interaction object send to it formatted information
as if it was a shell_interaction object, leading one to emulate libdar
default behavior under any time of "terminal".<span style="font-weight: bold;"><br>
      <br>
      </span><br>
      <h2>19 - Masks<br>
      </h2>

      <div style="text-align: justify;">Mask are used to define which <span style="text-decoration: underline;">string</span>
will be considered and which will not. Libdar implements masks as
several classes that all inherit from a virtual class that defines the
way masks are used. This root class is the <span style="font-weight: bold; font-style: italic;">class mask</span> and
provides the <span style="font-style: italic; font-weight: bold;">mask::is_covered(const std::string &amp; expression)</span><span style="font-weight: bold;"> </span>method
which libdar uses to determine which string are considered for an operation which are not.<br>
      <br>
Strings applied to masks may correspond to filename only, to full path
or maybe to other things. That's in the context where the mask is used
that the string meaning take place.<br>
      <br>
&nbsp;There is several different basic masks classes you can use
to build fairly
complex masks, while it is possible you should not need to define you
own mask classes, if the need arises, please contact libdar developer
if you thing an additional class should take place beside the following
ones:<br>
      </div>
      </td>
    </tr>
  </tbody>
</table>
<br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">class libdar::bool_mask<br>
      </td>
      <td style="vertical-align: top;">boolean mask, either always true
or false, it matches either all files or no files at all<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">class libdar::simple_mask<br>
      </td>
      <td style="vertical-align: top;">matches as done by the shell on
the command
lines (see "man 7 glob")<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">class libdar::regular_mask<br>
      </td>
      <td style="vertical-align: top;">matches regular expressions (see
"man 7 regex")<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">class libdar::not_mask<br>
      </td>
      <td style="vertical-align: top;">negation of another mask<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">class libdar::et_mask<br>
      </td>
      <td style="vertical-align: top;">makes an *AND* operator between
two or more masks<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">class libdar::ou_mask<br>
      </td>
      <td style="vertical-align: top;">makes the *OR* operator
between&nbsp; two or more masks <br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">class lbdar::simple_path_mask<br>
      </td>
      <td style="vertical-align: top;">
      <p>matches if it is subdirectory of mask or is a directory
that contains the specified path itself<br>
      </p>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">class libdar::same_path_mask<br>
      </td>
      <td style="vertical-align: top;">matches if the string is exactly
the
given mask (no wild card expression)<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top; width: 210px;">class
libdar::exclude_dir_mask<br>
      </td>
      <td style="vertical-align: top;">matches if string is the given
string or a sub directory of it<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">class libdar::mask_list<br>
      </td>
      <td style="vertical-align: top;">matches a list of files defined
in a given file<br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">Let's play with some masks : </td>
    </tr>
  </tbody>
</table>
<br>
<code></code><code></code>
<table style="width: 90%; height: 51px; text-align: left; margin-left: auto; margin-right: auto;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204);"><code><br>
      </code><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // all files will be
elected by this mask</code><br>
      <code>&nbsp; libdar::bool_mask m1(true);&nbsp;&nbsp;&nbsp; <br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // all string that match the glob
expession "A*~" will match. <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // the second argument of the
constructor tell whether the match is case sensitive so here <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // any file beginning by 'A' or by 'a'
and ending by '~' will be selected by this mask:<br>
&nbsp; libdar::simple_mask m2(std::string("A*~"),
false);<br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // m3 is the negation if m2. This mask
will thus match<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // any string that does not begin by 'A'
or 'a' or finishing by '~'<br>
&nbsp; libdar::not_mask m3(m2);<br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // this mask matches any string that is a
subdirectory of "/home/joe"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // and any directory that contains
/home/joe, meaning<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // "/", "/home", "/jome/joe" and any
subdirectory are matched.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // here, the second argument is also
case sensitivity (so<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp; "/HoMe" will not be selected by
this mask as we set it to "true".<br>
&nbsp; libdar::simple_path_mask m4 = simple_path_mask("/home/joe",
true);<br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // now let's do some more complex things:<br>
      </code><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // m5 will now match
only struings that are selected by both m2 AND m4</code><br>
      <code>&nbsp; libdar::et_mask m5;<br>
&nbsp; m5.add_mask(m2);<br>
&nbsp; m5.add_mask(m4);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // we can make more interesting things
like
this, where m5 will select files<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // that match m2 AND m4 AND m3. But <span style="font-style: italic;">m3 =
not m2</span> so now m5 will never<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // match any file...<br>
&nbsp; m5.add_mask(m3);<br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // but we could do the same with an
"ou_mask" and would get a silly<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // counterpart of m1 (a mask that
matches any files)<br>
&nbsp; libdar::ou_mask m6;<br>
&nbsp; m6.add_mask(m2);<br>
&nbsp; m6.add_mask(m4);<br>
&nbsp; m6.add_mask(m3);<br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // lastly, the NOT, AND and OR operation
can be used recursively.<br>
      </code><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Frankly, it's
possible to have masks referring each other!</code><br>
      <code>&nbsp; libdar::not_mask m7(m6);<br>
&nbsp; m6.add_mask(m7);<br>
      <br>
      <br>
      </code></td>
    </tr>
  </tbody>
</table>
<br>
<table style="text-align: left; width: 90%;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">The idea here is not to create
object manually, but to link their
creation to the action and choices the user makes from the user
interface (Graphical User Interface of your aplication, for example)<br>
      <br>
Now that you've seen the power
of these masks, you should know that in
libdar masks are used at several places:<br>
      <ul style="text-align: justify;">
        <li>A first place is to select files against
their
names (without path information) this the argument of the <span style="font-weight: bold;">set_selection()</span> method of <span style="font-style: italic;">libdar::archive_options_*</span> classes.
The mask here does not apply to directories.<br>
        </li>
        <li>A second place is to select files against their
path+name and it applies here to all type of files including
directories, this is the argument of the <span style="font-weight: bold;">set_subtree()</span> method of <span style="font-style: italic;">libdar::archive_options_*</span> classes.
So
with it, you can prune directories, or in any other way restrict the
operation to a particular subdirectory, as well as to a particular
plain file for example. <span style="font-weight: bold;">Important note</span>
about this second mask: what your own mask will be compared to by
libdar is the <span style="font-weight: bold;">absolute path</span> of
the file under consideration. If you want to exclude /usr/local/bin
from the operation whatever is the <span style="font-style: italic;">fs_root</span>
value (which correspond the -R option of dar) using here a <span style="font-style: italic;">libdar::simple_mask("/usr/local/bin")</span>
as argument of <span style="font-style: italic;">libdar::archive_options_*::get_subtree()</span>
will do the trick.<br>
        </li>
      </ul>
      <div style="text-align: justify;"> </div>
      <div style="margin-left: 80px; text-align: justify;"><span style="font-style: italic;"></span>An exception is the archive testing
operation, which has no <span style="font-style: italic;">fs_root</span>
argument (because the
operation is not relative to an existing filesystem), however the <span style="font-style: italic;">subtree</span> argument exist to receive a
mask for comparing the path of file to include or exclude from the
testing
operation. In this case the situation is as if the <span style="font-style: italic;">fs_root</span> was set to the value "<span style="font-style: italic;">&lt;ROOT&gt;</span>". For example, masks
will be compared to <span style="font-style: italic;">"&lt;ROOT&gt;/some/file"</span>
when performing an archive test operation.<br>
      </div>
      <div style="margin-left: 80px; text-align: justify;"> </div>
      <ul>
        <li>A third place concerns
Extended Attributes (EA), this is the argument of the <span style="font-weight: bold;">set_ea_mask() </span>method of
archive_options classes. It is applied to the full EA name in the form
&lt;domain&gt;.&lt;name&gt; where &lt;domain&gt; is any string value
like but not limited to the usual "user" or "system" domains.</li>
        <li>A fourth place concerne the file to compress or to avoid
compressing. This is the argument of the <span style="font-weight: bold;">set_compr_mask()</span>
method of <span style="font-style: italic;">libdar::archive_options_*</span>
classes. it is works the same as
set_selection() seen above, based only to filename without any path
consideration.</li>
        <li>A fifth place concern files that have need be prepared for
backup, this is the argument of the <span style="font-weight: bold;">set_backup_hook()
          </span>method
of <span style="font-style: italic;">libdar::archive_option_create</span>
class. I has to be used the same as
set_subtree(). For more about this feature see the backup-hook feature
in dar man page (-&lt;, -&gt; and -= options).<br>
        </li>
      </ul>
      </td>
    </tr>
  </tbody>
</table>
<br>

<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="2" cellspacing="2">

  <tbody>
    <tr>
      <td style="vertical-align: top;"><br>
      <h2>20 - Aborting an Operation</h2>
      <div style="text-align: justify;">If the POSIX thread support is
available,<span style="font-style: italic;"> libdar</span>
will be
built in a
thread-safe manner, thus you may have several thread using libdar calls
at the same time (but on different objects except concerning the
libdar::statistics which can be shared between threads). You may then
wish to interrupt a given thread. But
aborting a thread form the outside (like sending it a KILL signal) will
most of the time let some memory allocated or even worse can lead to
dead-lock
situation, when the killed thread was inside a critical section and had
not
got the opportunity to release a <span style="font-style: italic;">mutex</span>.
For that reason, libdar proposes a set
of calls to abort any processing libdar call which is ran by a given
thread. <br>
      </div>
      </td>
    </tr>
  </tbody>
</table>

<br>

<code></code><code></code>
<table style="width: 90%; height: 51px; text-align: left; margin-left: auto; margin-right: auto; font-family: monospace;" border="1" cellpadding="2" cellspacing="2">

  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204);"><code></code>&nbsp;&nbsp;
// next is the
thread ID in which we want to have
lidbar call canceled<br>
&nbsp;&nbsp; // here for simplicity we don't describe the way the
ID has been obtained<br>
pthread_t thread_id = 161720;<br>
&nbsp;&nbsp; <br>
&nbsp;&nbsp; // the most simple call is :<br>
libdar::cancel_thread(thread_id);<br>
&nbsp;&nbsp; // this will make any libdar call in this thread be
canceled immediately<br>
      <br>
&nbsp;&nbsp; // but you can use something a bit more interesting:<br>
libdar::cancel_thread(thread_id, false);<br>
&nbsp;&nbsp; // this second argument is true for immediate cancellation,<br>
&nbsp;&nbsp; // of false for a delayed cancellation, in which case
libdar
aborts the operation<br>
&nbsp;&nbsp; // but produces something usable. For example, if you were
backing up something<br>
&nbsp;&nbsp; // you get a real usable archive which only contains
files saved so far, in place<br>
&nbsp;&nbsp; // of having a broken archive which misses a catalogue at
the end. Note that this<br>
&nbsp;&nbsp; // delayed
cancellation needs a bit more time to complete, depending on the<br>
&nbsp;&nbsp; // size of the archive
under process.<br>
      <br>
      </td>
    </tr>
  </tbody>
</table>

<br>

<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="2" cellspacing="2">

  <tbody>
    <tr>
      <td style="vertical-align: top;">
      <div style="text-align: justify;">As seen above, cancellation can
be
very simple. What now succeeds when
you ask for a cancellation this way? Well, an exception of type <span style="font-weight: bold; font-style: italic;">Ethread_cancel</span>
is thrown. All along his path, memory is released and mutex are freed.
Last, the exception appears to the libdar caller. So, you can catch it
to define a specific comportment. And if you don't want to use
exceptions a
special returned code is used.<br>
      </div>
      </td>
    </tr>
  </tbody>
</table>

<br>

<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="1" cellpadding="2" cellspacing="2">

  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204); width: 50%;"><code>try<br>
{<br>
&nbsp; &nbsp; </code><code>libdar::archive my_arch(...);<br>
&nbsp;&nbsp;&nbsp; ...<br>
}<br>
catch(libdar::Ethread_cancel &amp; e)<br>
{<br>
&nbsp;&nbsp;&nbsp; ... do something specific when thread has been canceled;<br>
}<br>
      <br>
      </code><code> </code><br>
      </td>
      
    </tr>
  </tbody>
</table>

<br>

<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="2" cellspacing="2">

  <tbody>
    <tr>
      <td style="vertical-align: top;">
      <div style="text-align: justify;">Some helper routines are
available to
know the cancellation status for a particular thread or to abort a
cancellation process if it has not yet been engaged.<br>
      </div>
      </td>
    </tr>
  </tbody>
</table>

<br>

<code></code><code></code>
<table style="width: 90%; height: 51px; text-align: left; margin-left: auto; margin-right: auto;" border="1" cellpadding="2" cellspacing="2">

  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204);"><span style="font-family: monospace;">&nbsp;pthread_t
tid;</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp; </span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp; // how to know
if the thread </span><span style="font-style: italic; font-family: monospace;">tid</span><span style="font-family: monospace;"> is under cancellation process?</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">if(</span><span style="font-weight: bold; font-family: monospace;">libdar::cancel_status</span><span style="font-family: monospace;">(tid))</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;
cout &lt;&lt; "thread cancellation is under
progress for thread : " &lt;&lt; tid &lt;&lt; endl;</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">else</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;
cout &lt;&lt; "no thread cancellation is under
progress for thread : " &lt;&lt; endl;</span><br style="font-family: monospace;">
      <br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp; // how to
cancel a pending thread cancellation ?</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">if(</span><span style="font-weight: bold; font-family: monospace;">libdar::cancel_clear</span><span style="font-family: monospace;">(tid))</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp; cout
&lt;&lt; "pending thread cancellation has been
reset, thread " &lt;&lt; tid &lt;&lt; " has not been canceled" &lt;&lt;
endl;</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">else</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp; cout &lt;&lt;
"too late, could not avoid thread
cancellation for thread "&lt;&lt; tid &lt;&lt; endl;</span><br>
      <br>
      </td>
    </tr>
  </tbody>
</table>

<br>

<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="2" cellspacing="2">

  <tbody>
    <tr>
      <td style="vertical-align: top;">Last point, back to the<span style="font-weight: bold; font-style: italic;"> Ethread_cancel</span>
exception, this class has two methods you may find useful, when you
catch it: </td>
    </tr>
  </tbody>
</table>

<br>

<code></code><code></code>
<table style="width: 90%; height: 51px; text-align: left; margin-left: auto; margin-right: auto; font-family: monospace;" border="1" cellpadding="2" cellspacing="2">

  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204);"><code></code>try<br>
{<br>
&nbsp;&nbsp; ... some libdar calls<br>
}<br>
catch(libdar::Ethread_cancel &amp; e)<br>
{<br>
&nbsp;&nbsp; if(e.<span style="font-weight: bold;">immediate_cancel</span>())<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cout &lt;&lt; "cancel_thread() has
been called with "true" as second argument" &lt;&lt; endl;<br>
&nbsp;&nbsp; else<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cout &lt;&lt; "cancel_thread() has been
called with "false" as second argument" &lt;&lt; endl;<br>
      <br>
&nbsp;&nbsp; U64 flag = e.<span style="font-weight: bold;">get_flag</span>();<br>
&nbsp;&nbsp;&nbsp; ... do something with the flag variable...<br>
}<br>
      <br>
&nbsp;&nbsp;&nbsp; // what is this flag stored in this exception?<br>
&nbsp;&nbsp;&nbsp; // You must consider that the complete definition of
cancel_thread() is the following:<br>
&nbsp; &nbsp; // <span style="font-style: italic;">void
cancel_thread(pthread_t tid, bool immediate = true, U_64 flag = 0);<br>
&nbsp;&nbsp;&nbsp; </span>// thus, any argument given in third is
passed to the thrown Ethread_cancel exception, <br>
&nbsp;&nbsp;&nbsp; // value which can be retrieved thanks to its
get_flag() method. The value given to this<br>
&nbsp; &nbsp; // flag is not used by libdar itself, it is a facility
for user program to have the possibility <br>
&nbsp;&nbsp;&nbsp; // to include additional information about the
thread cancellation.<br>
      <br>
&nbsp;&nbsp;&nbsp; // supposing the thread cancellation has been
invoked by:<br>
libdar::cancel_thread(thread_id, true, 19);<br>
&nbsp;&nbsp; // then the<span style="font-style: italic;"> flag</span>
variable in the catch() statement above would have received<br>
      <div style="text-align: justify;">&nbsp;&nbsp; // the value <span style="font-style: italic;">19</span>.<br>
      </div>
      </td>
    </tr>
  </tbody>
</table>

<code></code><code></code><br>
<hr style="width: 100%; height: 2px;"><br>
<div style="text-align: justify;"><br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">
      <div style="text-align: justify;"> </div>
      
      
      <h2 style="text-align: justify;">21 - Dar_manager API</h2>
      <br>
      <div style="text-align: justify;">For more about <span style="font-style: italic;">dar_manager</span>, please read the&nbsp;<span style="font-style: italic;"></span>man page where are described in
detail the available features. Note that for <span style="font-style: italic;">dar_manager</span> there is not
a "<span style="font-style: italic;">without exception</span>" flavor,
your
program
must be able to handle exceptions, which by the way are the same as the
ones described above.<br>
      </div>
      <br>
      <div style="text-align: justify;">To get dar_manager features you
need to use the <span style="font-weight: bold; font-style: italic;">class
database</span>
which is defined in the <span style="font-style: italic; font-weight: bold;">libdar/database.hpp</span>
header file so <span style="text-decoration: underline;">you first
need to include that file</span>. Most of the methods of the <span style="font-style: italic;">database</span> class do use options. For
the same reason as previously seen for <span style="font-style: italic;">archive</span> manipulation, these options
are passed thanks to a container class. These container classes for
options used by the <span style="font-style: italic;">database</span>
class are defined in the<span style="font-style: italic;">
libdar/database_options.hpp</span> file. Let's see the
different method of the class <span style="font-style: italic;">database</span>
:<br>
      </div>
      <br>
      <h3>Database object construction</h3>
Two constructor are available: </td>
    </tr>
  </tbody>
</table>
<br>
</div>

<code></code><code></code>
<table style="width: 90%; height: 51px; text-align: left; margin-left: auto; margin-right: auto;" border="1" cellpadding="2" cellspacing="2">

  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204);"><code>#include
&lt;dar/database.hpp&gt;<br>
      </code><code><span style="font-weight: bold;"></span><br>
void my_sample_function(user_interaction &amp; dialog)<br>
{<br>
&nbsp; &nbsp; database base; &nbsp; // we have created an empty
database (no archive in it) called "base"<br>
      <br>
&nbsp; &nbsp; database other&nbsp; = database(dialog,
"/tmp/existing_base.dmd", database_open_options());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// we have created a database object called "other" which contains <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// (in RAM) all information that were contained in the <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// database file "/tmp/existing_base.dmd"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// I will explain below the last argument<br>
      <br>
&nbsp;&nbsp;&nbsp; database_open_option opt;<br>
&nbsp;&nbsp;&nbsp; opt.set_partial(true);<br>
&nbsp;&nbsp;&nbsp; database other2 = database(dialog,
"/tmp/existing_base.dmd", opt);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// we have created a database object called "other2" which differs<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// from "other" in the option we used. While "other" is a fully loaded <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// database, "other2" is a partial database. This notion is explained <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// below<br>
}</code> <br>
      <br>
      </td>
    </tr>
  </tbody>
</table>

<br>

<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="2" cellspacing="2">

  <tbody>
    <tr>
      <td style="vertical-align: top;">
      <div style="text-align: justify;">So far, this is not much
complicated.
You can build an empty database
from nothing, or load a database to memory from a file using the second
constructor. As you can see over the filename to give in this later
constructor, we need a <span style="font-style: italic;">user_interaction</span>
object to be able to inform the
user of any problem that could be met, and an object of class
database_open_options. This last object contains options to use for
this call (options are set to their default unless modified
explicitely). Currently, the only available option is the "partial"
option which is a boolean argument:<br>
      <br>
In all the available methods for class database, some require to load
the whole database in the memory while some other only require
the database header. Loading just the database header is much faster
than loading the whole database, of course, and as you guess it
requires
much less memory. While you can perform any operation with a full
loaded database, only a subset of available method will be available
with a partially loaded database.&nbsp; If you try a method that
requires a completely loaded database, you will get an exception if the
object you use has been loaded with "true" as last argument (called
"partial") of the constructor, and of course an empty database (built
with the first
constructor) is a completely loaded database, so you don't have
restriction in using a new database object. <br>
      <br>
But now let's see the
available method for that class:<br>
      </div>
      <br>
      <h3>Database's methods <br>
      </h3>
First we will see methods that work with both partially and completely
loaded databases:<br>
      <ul><li>dump(...) : it is used to write back the database to a
file. <br>
        </li><li>change_name() : change the basename of the archive which
index is
given in argument</li><li>set_path() : change the path to the archive which index is
given
in argument</li><li>set_options() : change the default options to always pass
to dar
when performing restoration</li><li>set_dar_path() : specify the path to dar (use empty string
to
rely on the PATH variable)</li><li>show_contents() : list the archives used to build the
database</li><li>get_options() : list the options that will be passed to dar
(as
defined with the set_options() method)</li><li>get_dar_path() : return the path to dar (or empty string if
relying on the PATH variable)</li></ul>
      <br>
Now let's see the database methods that only work with completely
loaded databases:<br>
      <ul><li>add_archive() : add an archive to the database</li><li>remove_archive() : remove an archive from the database</li><li>set_permutation() : change archive relative order within
the
database</li><li>show_files() : list the files which are present in the
given
archive<br>
        </li><li>show_version() : list the archive where the given file is
saved</li><li>show_most_recent_stats() :&nbsp; compute statistics about
the
location of most recent file versions</li><li>restore() : restore a set of given files given in argument.</li></ul>
      <div style="text-align: justify;">Well, you might now say that as
description this is a bit light for a
tutorial, yes. In fact these call are really very simple to use, you
can find a complete description in the reference documentation of the
API. This documentation is built if doxygen is available and is put
under doc/html after calling make in the source
package. It is also available from <a href="http://dar.linux.free.fr/html/">dar's
homepage</a>. </div>
      </td>
    </tr>
  </tbody>
</table>

<br>
<hr style="width: 100%; height: 2px;"><br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;"><br>
      <h2>15 - Compilation &amp; Linking<br>
      </h2>
      <h3>Compilation</h3>
      <div style="text-align: justify;">All the symbols found in the
libdar API except the one relative to dar_manager (see below) are
defined from <span style="font-style: italic; font-weight: bold;">&lt;dar/libdar.h&gt;</span>.
So
you should only need to include this header. If the header file is not
located in a standard directory, in order to compile your code, you may
need some extra
flags to pass to the compiler (like -I/opt/...). The <span style="font-weight: bold;">pkg-config</span> tool can help here to
avoid system dependent
invocation:<br>
      </div>
      </td>
    </tr>
  </tbody>
</table>
<br>
<code></code><code></code>
<table style="width: 90%; height: 51px; text-align: left; margin-left: auto; margin-right: auto;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204);"><br>
      <code></code><span style="font-family: monospace;">&gt; cat
my_prog.cpp</span><br style="font-family: monospace;">
      <br style="font-family: monospace;">
      <span style="font-weight: bold; font-family: monospace;">
#include &lt;dar/libdar.h&gt;</span><br style="font-family: monospace;">
      <br style="font-family: monospace;">
      <span style="font-family: monospace;">main()</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">{</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp;
libdar::get_version(...);</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp; ...</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">}</span><br style="font-family: monospace;">
      <br style="font-family: monospace;">
      <span style="font-family: monospace;">&gt; <span style="font-weight: bold;">gcc `pkg-config --cflags libdar` -c
my_prog.cpp</span></span><br>
      <br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">
      <h3><br>
      </h3>
      <h3>Linking</h3>
      <br>
Of course, you need to link your program with libdar. This is done by
adding <span style="font-style: italic; font-weight: bold;">-ldar</span>
plus
other library libdar can rely on like libz, libbzip2, liblzo or
libgcrypt, depending on the feature activated at compilation time. Here
too, <span style="font-weight: bold;">pkg-config</span> can provide a
great help to avoid having system
dependent invocation:<code> </code> </td>
    </tr>
  </tbody>
</table>
<br>
<table style="width: 90%; height: 51px; text-align: left; margin-left: auto; margin-right: auto;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204);"><code></code><code></code><span style="font-weight: bold;"></span><br>
&gt; gcc <span style="font-weight: bold;">pkg-confg --libs libdar`</span>
my_prog.o -o
my_prog<br>
      <br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<table style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">
      <h3>Libdar's different flavors</h3>
      <br>
      <div style="text-align: justify;">Well, all the compilation and
linking
steps described above assume you
have a "<span style="font-style: italic;">full</span>" libdar library.
Beside the <span style="font-style: italic;">full</span> (alias <span style="font-style: italic;">infinint</span>) libdar flavor, libdar
also comes in 32 and 64 bits
versions. In these last ones, in place of internally relying on a
special type (which
is a C++ class called<span style="font-style: italic;"> infinint</span>)
to
handle arbitrary large integers, libdar32 relies on 32 bits integers
and
libdar64 relies on 64 bits integers (there are limitations which are
described in doc/LIMITATIONS). But all these libdar version (infinint,
32bits, 64bits) have the same
interface and must be used the same way, except for compilation and
linking.<br>
      </div>
      <br>
      <div style="text-align: justify;">These different libdar
versions can
coexist on the same system, they
share the same include files. But the LIBDAR_MODE macro must be set to
32
or 64 when compiling or linking with libdar32 or libdar64
respectively. The LIBDAR_MODE macro defines the way the "<span style="font-style: italic;">class infinint" </span>type
is
implemented in libdar, and thus changes the way the libdar headers
files are interpreted by the compiler. <span style="font-weight: bold;">pkg-config
--cflags</span> will set the
correct LIBDAR_MODE, so you should only bother calling it with either
libdar, libdar32 or libdar64 depending on your need : "<span style="font-weight: bold;">pkg-confg
--cflags libdar64</span>" for example.<br>
      </div>
      </td>
    </tr>
  </tbody>
</table>
<br>
<code></code><code></code>
<table style="width: 90%; height: 51px; text-align: left; margin-left: auto; margin-right: auto;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; background-color: rgb(204, 204, 204);"><code></code>&gt;
cat my_prog.cpp<span style="font-weight: bold;"><br>
      </span>#include &lt;dar/libdar.h&gt;<br>
      <br>
main()<br>
{<br>
&nbsp;&nbsp; libdar::get_version(...);<br>
&nbsp;&nbsp; ...<br>
}<br>
&gt; gcc -c <span style="font-weight: bold;">`pkg-config --cflags
libdar32`</span>
my_prog.cpp<br>
      <br>
      <code></code><code></code><span style="font-weight: bold;"></span><br>
&gt; gcc <span style="font-weight: bold;">`pkg-config --libs libdar32`</span>
my_prog.o -o
my_prog<br>
      <br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<table style="width: 90%; margin-right: auto; margin-left: auto; text-align: left;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">and replace 32 by 64 to link
with libdar64. <br>
      <br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<br>
</center>

<br>
</body></html>