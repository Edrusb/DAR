<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>Libdar API - Tutorial</title>
  <meta content="Denis Corbin" name="author">
  <meta content="Tutorial for using libdar library" name="description">
</head>
<body>
<h1 style="text-align: center;"> LIBDAR <br>
</h1>
<h1 style="text-align: center;">APPLICATION INTERFACE <br>
</h1>
<h1 style="text-align: center;">TUTORIAL</h1>
<div style="text-align: center;">&nbsp; for API version 3.0.x<br>
<br>
</div>
<hr style="width: 100%; height: 2px;"><br>
<h2>Presentation</h2>
<div style="text-align: justify;">
<p>The Libdar library has been built from source code originally
located directly in the <em><strong>dar</strong></em> command line
application. Libdar provides a complete abstraction for handling Disk
ARchive (<em>dar</em>)'s archives. The general operations provided are:</p>
</div>
<ul>
  <li>archive creation, </li>
  <li>file extraction, </li>
  <li>archive listing, </li>
  <li>archive testing, </li>
  <li>archive comparison,</li>
  <li>catalogue isolation. </li>
</ul>
<div style="text-align: justify;">Note that <span
 style="font-style: italic;">Disk ARchive</span> <em>and</em> libdar
have been released under the <span style="font-style: italic;">Gnu
General Public License </span>(GPL). All code linked to libdar
(statically or dynamically), <span style="font-weight: bold;"> must
also be covered by the GPL.</span><br>
</div>
<br>
<div style="text-align: justify;">This tutorial will show you how to
use the libdar API. As <span style="font-style: italic;">dar</span>
now also uses this API, looking at it's code may also provide a good
illustration. The file <span style="font-style: italic;">dar_suite/dar.cpp</span>
is the primary consumer.<br>
</div>
<br>
<div style="text-align: justify;">The sample code provided here is
solely illustrative and is not guaranteed to compile. More detailed API
documentation is contained in the source code and can be compiled to
the doc/html directory using Doxygen. The API reference is also
available <a href="http://dar.linux.free.fr/html/index.html">online</a>.<br>
</div>
<br>
<hr style="width: 100%; height: 2px;"><br>
<h2>Let's Start</h2>
<h3>Conventions</h3>
<h4>Language</h4>
Dar and libdar are written in C++, and so is the libdar API. While
written in C++, libdar is easily usable with both C and C++ code.
Access from other languages can be provided by specific bindings. I
would only say that you are welcome to provide the necessary bindings
yourself. :-)
<h4>Libdar namespace</h4>
<div style="text-align: justify;">All libdar symbols are defined under
the <span style="font-style: italic; font-weight: bold;">libdar </span><span
 style="font-weight: bold;">namespace</span>. You
can either add the <span style="font-style: italic;">using namespace
libdar;</span> line at the beginning of your source files:<br>
</div>
<br>
<table
 style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 204);"><code>using
namespace libdar;<br>
      </code><br>
      <code>get_version(....);<br>
      </code></td>
    </tr>
  </tbody>
</table>
<br>
<div style="text-align: justify;">&nbsp;or, as shown below, you can
explicitly use the namespace in front of libdar objects :<br>
</div>
<br>
<code></code>
<table
 style="width: 90%; height: 51px; text-align: left; margin-left: auto; margin-right: auto;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 204);"><code><br>
libdar::get_version(....);<br>
      </code></td>
    </tr>
  </tbody>
</table>
<br>
<h4>Exceptions or no Exceptions</h4>
<div style="text-align: justify;">The library can be used with or
without exceptions. For each example we will see sample code for both
methods. To the left is with exceptions, to the right without:<br>
</div>
<br>
<table
 style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(153, 255, 255); width: 50%;"><code><br>
example
code <span style="font-weight: bold;">using exceptions</span><br>
      <br>
      </code> </td>
      <td
 style="vertical-align: top; background-color: rgb(153, 255, 153); width: 50px;"><code><br>
example
code <span style="font-weight: bold;">not using</span> exceptions</code><br>
      </td>
    </tr>
  </tbody>
</table>
<br>
All exceptions used by <span style="font-style: italic;">libdar</span>
inherit from the pure virtual <span style="font-style: italic;"><span
 style="font-weight: bold;">class Egeneric</span>.</span> The only
method you will need to know about for any exception is the <span
 style="font-style: italic; font-weight: bold;">get_message()</span>
call, which returns a message string describing the message (in human
language). The type of the error is defined by the class of the
exception. The possible exception types follow:<br>
<br>
<table
 style="width: 90%; text-align: left; margin-left: auto; margin-right: 0px;"
 border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; width: 200px;"><code>class
libdar::Egeneric<br>
      </code></td>
      <td style="vertical-align: top;"> the parent class of all
exceptions (a pure virtual class)<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><code>class libdar::Ememory<br>
      </code></td>
      <td style="vertical-align: top;">memory has been exhausted<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><code>class libdar::Ebug<br>
      </code></td>
      <td style="vertical-align: top;">signals a bug, which is
triggered when reaching some code that should never be reached<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><code>class libdar::Einfinint<br>
      </code></td>
      <td style="vertical-align: top;">arithmetic error detected when
operating on infinint<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><code>class libdar::Elimitint<br>
      </code></td>
      <td style="vertical-align: top;">a limitint overflow is detected,
indicating the maximum value of the limitint has been exceeded<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><code>class libdar::Erange<br>
      </code></td>
      <td style="vertical-align: top;">signals a range error<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><code>class libdar::Edeci<br>
      </code></td>
      <td style="vertical-align: top;">signals conversion problem
between infinint and string (decimal representation)<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><code>class libdar::Efeature<br>
      </code></td>
      <td style="vertical-align: top;">a requested feature is not (yet)
implemented<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><code>class libdar::Ehardware<br>
      </code></td>
      <td style="vertical-align: top;">hardware problem is found <br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><code>class libdar::Euser_abort<br>
      </code></td>
      <td style="vertical-align: top;">signals that the user has
aborted the operation <br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><code>class libdar::Edata<br>
      </code></td>
      <td style="vertical-align: top;">an error concerning the treated
data has been encountered<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><code>class libdar::Escript<br>
      </code></td>
      <td style="vertical-align: top;">the script executed between
slices returned an error code<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><code>class libdar::Elibcall<br>
      </code></td>
      <td style="vertical-align: top;">signals an error in the
arguments given to a libdar call of the API<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><code>class libdar::Ecompilation<br>
      </code></td>
      <td style="vertical-align: top;">a requested feature has not been
activated at compilation time<br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<br>
<hr style="width: 100%; height: 2px;"><br>
<br>
<h2>&nbsp;1 - First we *must* check the libdar version </h2>
<br>
<table
 style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(153, 255, 255); width: 50%;"><code>&nbsp;&nbsp;
      <br>
&nbsp;&nbsp;&nbsp; // we'll want to display some messages<br>
#include &lt;io.h&gt;<br>
      <br>
&nbsp;&nbsp;&nbsp; // we include this header to access lidbar API<br>
#include &lt;dar/libdar.h&gt;<br>
      <br>
&nbsp;&nbsp;&nbsp; // all sample code shown will be inside this<br>
&nbsp;&nbsp;&nbsp; // function for simplicity's sake<br>
void my_sample_function()<br>
{<br>
&nbsp;&nbsp; try<br>
&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; libdar::U_I maj, med, min;<br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // first we <span
 style="font-weight: bold;">MUST </span>call
get_version()<br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; libdar::<span style="font-weight: bold;">get_version</span>(maj,
med, min); <br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(maj !=
libdar::LIBDAR_COMPILE_TIME_MAJOR ||<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; med &lt;
libdar::LIBDAR_COMPILE_TIME_MEDIUM)<br>
&nbsp; &nbsp; &nbsp; &nbsp; throw libdar::Erange("initialization", <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "we are linking against a
wrong libdar"); <br>
&nbsp;&nbsp; }</code><br>
      <code>&nbsp;&nbsp; catch(libdar::Egeneric &amp; e)<br>
&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; e.get_message()
&lt;&lt;
std::endl;<br>
&nbsp;&nbsp; }<br>
}<br>
      <br>
&nbsp;&nbsp; <br>
      </code> </td>
      <td
 style="vertical-align: top; background-color: rgb(153, 255, 153); width: 50px;"><code></code><code>&nbsp;&nbsp;
      <br>
&nbsp;&nbsp;&nbsp; // we'll want to display some messages<br>
#include &lt;io.h&gt;<br>
      <br>
&nbsp;&nbsp;&nbsp; // we include this header to access lidbar API<br>
#include &lt;dar/libdar.h&gt;<br>
      <br>
&nbsp;&nbsp;&nbsp; // all sample code shown will be inside this<br>
&nbsp;&nbsp;&nbsp; // function for simplicity's sake<br>
void my_sample_function()<br>
{<br>
      <br>
&nbsp;&nbsp; </code><code> libdar::U_I maj, med, min;<br>
&nbsp;&nbsp; libdar::U_16 excode;<br>
&nbsp;&nbsp; std::string msg;<br>
      </code><code><br>
&nbsp;&nbsp;&nbsp; // first we <span style="font-weight: bold;">MUST </span>call
get_version()<br>
      <br>
&nbsp;&nbsp; libdar::<span style="font-weight: bold;">get_version_noexcept</span>(maj,
med, min, <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
excode, msg);<br>
      <br>
&nbsp;&nbsp; if(excode != LIBDAR_NOEXCEPT)<br>
&nbsp;&nbsp; { <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; msg &lt;&lt; endl;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return;<br>
&nbsp;&nbsp; }<br>
&nbsp; <br>
&nbsp;&nbsp; if(maj != LIBDAR_COMPILE_TIME_MAJOR ||<br>
&nbsp; &nbsp; &nbsp; </code><code>med &lt;
libdar::LIBDAR_COMPILE_TIME_MEDIUM</code><code>)<br>
&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; </code><code>"we are
linking against wrong libdar"</code><code> &lt;&lt; std::endl;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return;<br>
&nbsp;&nbsp;&nbsp; }<br>
      </code> </td>
    </tr>
  </tbody>
</table>
<br>
The get_version* family function must be called for
several reasons :<br>
</dar></io>
<ul>
  <li>
    <div style="text-align: justify;">you must check that the library
you've dynamically linked with is compatible with the features you will
be using. The major number must be the same, for no compatibility is
assured between two libdar versions of different major numbers. While
run-time compatibility is assured between medium numbers, the medium
number must be greater or equal to the one used at compilation time to
be sure that all the features you want are available in the libdar
library you dynamically linked with. Changes between minor versions
correspond to bug fixes and is not to imply any API change, thus no
constraints are present there.<br>
    </div>
  </li>
  <li style="text-align: justify;">the get_version* call, as well as
returning version information, does important initialization tasks for
libdar. If not called first, the libdar library will not initialized
properly and its behavior will be unpredictable. Note that you may call
get_version* several time if you wish, using any override.<br>
  </li>
</ul>
<h2>2 - Let's see the available features</h2>
once we have called a function of the <span style="font-style: italic;">get_version*</span>
function it is possible to access the features activated at compilation
time:<br>
<br>
<table
 style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(153, 255, 255); width: 50%;"><code><br>
      <br>
void my_sample_function()<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // let's continue in the
same function<br>
      <br>
&nbsp;&nbsp;&nbsp; bool ea;<br>
&nbsp;&nbsp;&nbsp; bool largefile;<br>
&nbsp;&nbsp;&nbsp; bool nodump;<br>
&nbsp;&nbsp;&nbsp; bool special_alloc;<br>
&nbsp;&nbsp;&nbsp; libdar::U_I bits;<br>
&nbsp;&nbsp;&nbsp; bool thread_safe;<br>
&nbsp;&nbsp;&nbsp; bool libz;<br>
&nbsp;&nbsp;&nbsp; bool libbz2;<br>
&nbsp;&nbsp;&nbsp; bool libcrypto;<br>
      <br>
&nbsp;&nbsp;&nbsp; libdar::<span style="font-weight: bold;">get_compile_time_features</span>(ea,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
largefile,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
nodump,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
special_alloc,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
bits,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
thread_safe,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
libz,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
libbz2,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
libcrypto);<br>
      </code><br>
}<br>
      <br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(153, 255, 153); width: 50px;"><code></code>
      <code><br>
      <br>
&nbsp;// here there is no difference because no exceptions<br>
&nbsp;// are thrown by the get_compile_time_feature() <br>
&nbsp;// function<br>
      </code> </td>
    </tr>
  </tbody>
</table>
<br>
<br>
<div style="text-align: justify;">You can do what you want with the
resulting values. It's possible to display the available libdar
features or to terminate if you don't find a desired feature. However,
verifying that features are available is not strictly necesary because
libdar will tell you if an operation you call requires a feature that
has not been activated by throwing an Ecompile exception or returning
the <span style="font-style: italic;">LIBDAR_ECOMPILATION</span> error
code.<br>
</div>
<br>
<br>
<h2>3 -User interaction</h2>
<div style="text-align: justify;">
<h3>The generic <span style="font-style: italic;">user_interaction</span>
class</h3>
To be able to report messages to the user and prompt for feedback a
special class called<span style="font-style: italic;"> <span
 style="font-weight: bold;">user_interaction </span></span>has been
introduced. Simply put, <span style="font-style: italic;">user_interaction</span>
is a virtual class which you can derive to provide user interaction (a
GUI's graphical interaction, for example). There are four methods whose
prototypes you must override:<br>
</div>
<br style="font-style: italic; font-weight: bold;">
<span style="font-style: italic; font-weight: bold;">void&nbsp;</span><span
 style="font-style: italic; font-weight: bold;" class="el">pause</span><span
 style="font-style: italic; font-weight: bold;"> (const std::string
&amp;message);</span><br>
<div style="margin-left: 40px; text-align: justify;">this method is
called by libdar when the library needs a yes or no ("continue" or
"kill")
answer to a question, which is provided by the string <em>message</em>.
The question posed by <em>pause()</em> must be answered by returning
"true" or throwing a <em><strong>Euser_abort</strong></em>
exception if the user refused the proposition<span
 style="font-weight: bold;"><span style="font-weight: bold;">. </span></span>Don't
worry about throwing an exception in your code; it will be trapped by
libdar if you don't want to manage exceptions, and are using libdar in
the "no exception" method. (<strong>NOTE</strong>: Unfortunately there
is currently no way to send
+ back a cancel signal without throwing an exception. For next API
version a new method called <em>pause2()</em> will allow you to answer
"true" or "false" and thus avoid using exceptions)<br>
<span style="font-weight: bold;"><span style="font-weight: bold;"><br>
<br>
</span></span></div>
<span style="font-style: italic; font-weight: bold;">void&nbsp;</span><span
 style="font-style: italic; font-weight: bold;" class="el">warning</span><span
 style="font-style: italic; font-weight: bold;"> (const std::string
&amp;message);</span><br>
<div style="margin-left: 40px; text-align: justify;">libdar calls this
method to display an informational message to the user. It is not
always a warning as the name suggests, but sometimes just normal
information.<br>
</div>
<br>
<span style="font-style: italic; font-weight: bold;">std::string&nbsp;</span><span
 style="font-style: italic; font-weight: bold;" class="el">get_string</span><span
 style="font-style: italic; font-weight: bold;"> (const std::string
&amp;message, bool echo);</span><br>
<div style="margin-left: 40px; text-align: justify;">This call is used
to get a arbitrary answer from the user. This is mainly used to get a
password from the user (when no password has been supplied for an
encrypted archive), the <span style="font-style: italic;">echo </span>argument
indicates if the user response should be displayed on the screen
(again, very useful for handling password input). If <span
 style="font-style: italic;">echo</span> is set to "false" the
implementation of <span style="font-style: italic;">get_string() </span>should
hide the characters typed by the user.<br>
</div>
<br style="font-style: italic; font-weight: bold;">
<span style="font-style: italic; font-weight: bold;">&nbsp;</span><span
 style="font-style: italic; font-weight: bold;" class="el">user_interaction</span><span
 style="font-style: italic; font-weight: bold;"> *&nbsp;</span><span
 style="font-style: italic; font-weight: bold;" class="el">clone</span><span
 style="font-style: italic; font-weight: bold;">
() const;</span><br>
<div style="margin-left: 40px; text-align: justify;">A deep copy
operation must be implemented here. This is because libdar stores the
reference to the <span style="font-style: italic;">user_interaction</span>
class as a pointer but may want to keep a complete internal copy at
some point. A simple implementation of this method should be something
like this (even if you don't want to use exceptions):<br>
<br>
</div>
<code></code><code></code>
<table
 style="width: 90%; height: 51px; text-align: left; margin-left: auto; margin-right: auto;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 204);"><code><br>
      </code><code>user_interaction
*my_own_class::clone() const<br>
{<br>
&nbsp;&nbsp;&nbsp; my_own_class *ret = new my_own_class(*this);<br>
&nbsp;&nbsp;&nbsp; if(ret == NULL)<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; throw
Ememory("user_interaction_callback::clone");<br>
&nbsp;&nbsp;&nbsp; else<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; return ret;<br>
}<br>
      </code><br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<h3>The callback interaction class</h3>
<div style="text-align: justify;">An inherited class from<span
 style="font-style: italic;"> user_interaction</span> called <span
 style="font-weight: bold; font-style: italic;">user_interaction_callback</span>
provides an implementation of the user interaction based on callback
functions. This allows you to replace the three interactions methods
(pause, warning and get_string) by three normal functions of your
choice, which must be given to the <span style="font-style: italic;">user_interaction_callback</span>'s
constructor. The <span style="font-style: italic;">clone()</span>
method is implemented internally, leaving only the three callback
functions to be implemented. Look at <span style="font-style: italic;">
dar</span>'s command line code for a practical example. <span
 style="font-style: italic;">dar</span>'s user interaction code is
implemented using an instance of <span style="font-style: italic;">user_interaction_callback</span>
and three static functions in the module<span
 style="font-style: italic;"> dar_suite/shell_interaction.cpp</span> <br>
<br>
Pay attention to the <span style="font-style: italic;">contextual</span>
value present in the arguments of theses callback functions :<br>
&nbsp;<br>
<code></code><code></code>
<table
 style="width: 90%; height: 51px; text-align: left; margin-left: auto; margin-right: auto;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 204);"><code>&nbsp;
      </code><code><br>
&nbsp; // our own callback functions. <br>
&nbsp; // for the illustration of what theses 'context' arguments<br>
&nbsp; // can be used for we will imagine the situation where<br>
&nbsp; // multiple windows or multiple threads may each one use <br>
&nbsp; // libdar. But all share the same callback functions<br>
&nbsp;<br>
typedef class t_window_type t_win;<br>
      <br>
&nbsp; // this is an arbitrary type that here we will say<br>
&nbsp; // points to a graphical window object wrapped in a C++<br>
&nbsp; // class. <br>
&nbsp; // Note that the method show() wait_for_click() and so on<br>
&nbsp; // attributed to the t_win class are absolutely<br>
&nbsp; // imaginary. Any link to an existing class is a pure <br>
&nbsp; // coincidence...<br>
      <br>
void warning_callback(const std::string &amp;x, void *context)<br>
{<br>
&nbsp;&nbsp;&nbsp; (t_win *)(context)-&gt;show(x);<br>
}<br>
&nbsp;<br>
bool answer_callback(const std::string &amp;x, void *context)<br>
{<br>
&nbsp;&nbsp;&nbsp; click_type ret;<br>
      <br>
&nbsp; &nbsp; </code><code>(t_win *)(context)-&gt;show(x);<br>
&nbsp;&nbsp;&nbsp; ret = (t_win *)(context)-&gt;wait_for_click();<br>
      <br>
&nbsp;&nbsp;&nbsp; return ret == click_OK;<br>
      </code><code>}<br>
      <br>
std::string string_callback(const std::string &amp;x, bool echo, void
*context)<br>
{<br>
&nbsp;&nbsp;&nbsp; (t_win *)(context)-&gt;show(x);<br>
&nbsp;&nbsp;&nbsp; if(!echo)<br>
&nbsp;&nbsp; &nbsp;&nbsp; (t_win *)(context)-&gt;set_hide_typed_char();<br>
&nbsp;&nbsp;&nbsp; (t_win *)(context)-&gt;wait_for_click();<br>
&nbsp;&nbsp;&nbsp; return (t_win *)(context)-&gt;read_text();<br>
}<br>
      <br>
---------8&lt;-------8&lt;-------8&lt;-------<br>
      <br>
&nbsp; // So now each window can have its user_interaction object based
on the same<br>
&nbsp; // user_interaction_callback object pointing to the same
functions.<br>
&nbsp; // user_interaction_callback objects can be shared among
different window objects<br>
      <br>
libdar::user_interaction_callback dialog = <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
libdar::user_interaction_callback(&amp;warning_callback,
&amp;answer_callback, &amp;string_callback,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
(void *)get_current_windows_id());<br>
      <br>
&nbsp; // just the "context" argument changes, and will be passed as is
from the constructor to the callback<br>
&nbsp; // functions<br>
      </code><br>
      </td>
    </tr>
  </tbody>
</table>
<br>
</div>
<br>
<h2>4 - Masks</h2>
<div style="text-align: justify;">Mask are used to define which files
will be considered and which will not. Libdar implements masks as
several classes that all inherit from a virtual class that defines the
way masks are used. This root class is the <span
 style="font-weight: bold; font-style: italic;">class mask</span> and
provides the <span style="font-style: italic;">is_covered()</span>
method which libdar uses to determine which files are considered. There
are many different basic masks classes you can use to build fairly
complex masks:<br>
</div>
<br>
<br>
<table
 style="width: 90%; text-align: left; margin-left: auto; margin-right: 0px;"
 border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; width: 200px;">class libdar::mask<br>
      </td>
      <td style="vertical-align: top;">the generic class, parent of all
masks (a pure virtual class)<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">class libdar::bool_mask<br>
      </td>
      <td style="vertical-align: top;">boolean mask, either always true
or false, it matches either all files or no files at all<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">class libdar::simple_mask<br>
      </td>
      <td style="vertical-align: top;">matches as done by the shell on
the command
lines (see "man 7 glob")<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">class libdar::regular_mask<br>
      </td>
      <td style="vertical-align: top;">matches regular expressions (see
"man 7 regex")<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">class libdar::not_mask<br>
      </td>
      <td style="vertical-align: top;">negation of another mask<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">class libdar::et_mask<br>
      </td>
      <td style="vertical-align: top;">makes an *AND* operator between
two or more masks<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">class libdar::ou_mask<br>
      </td>
      <td style="vertical-align: top;">makes the *OR* operator
between&nbsp; two or more masks <br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">class lbdar::simple_path_mask<br>
      </td>
      <td style="vertical-align: top;">
      <p>string matches if it is subdirectory of mask or is a directory
that contains the specified path itself<br>
      </p>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">class libdar::same_path_mask<br>
      </td>
      <td style="vertical-align: top;">matches if the string is exactly
the
given mask (no wild card expression)<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top; width: 210px;">class
libdar::exclude_dir_mask<br>
      </td>
      <td style="vertical-align: top;">matches if string is the given
string or a sub directory of it<br>
      </td>
    </tr>
  </tbody>
</table>
<br>
Let's play with some masks :<br>
<br>
<br>
<code></code><code></code>
<table
 style="width: 90%; height: 51px; text-align: left; margin-left: auto; margin-right: auto;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 204);"><code><br>
      </code><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // all files will be
elected by this mask</code><br>
      <code>&nbsp; libdar::bool_mask m1 = true;&nbsp;&nbsp;&nbsp; <br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // all file that match the glob
expession "A*~" will match. <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // the second argument of the
constructor tell if the match is case sensitive so here <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // any file beginning by 'A' or by 'a'
and ending by '~' will be selected by this mask<br>
&nbsp; libdar::simple_mask m2 = libdar::simple_mask(std::string("A*~"),
false);<br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // m3 is the negation if m2. This mask
will thus match<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // any file that does not begin by 'A'
or 'a' and also finish by '~'<br>
&nbsp; libdar::not_mask m3 = m2;<br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // this mask matches any file that is a
subdirectory of "/home/joe"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // and any directory that contains
/home/joe, meaning<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // "/", "/home", "/jome/joe" and any
subdirectory are matched.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // here, the second argument is also
case sensitivity (so<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp; "/HoMe" will not be selected by
this mask.<br>
&nbsp; libdar::simple_path_mask m4 = simple_path_mask("/home/joe",
true);<br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // now let's do some more complex things:<br>
      </code><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // m5 will now match
only files that are selected by both m2 AND m4</code><br>
      <code>&nbsp; libdar::et_mask m5;<br>
&nbsp; m5.add_mask(m2);<br>
&nbsp; m5.add_mask(m4);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // we can make more silly things like
this, where m5 will select files<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // that match m2 AND m4 AND m3. But <span
 style="font-style: italic;">m3 =
not m2</span> so now m5 will never<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // match any file...<br>
&nbsp; m5.add_mask(m3);<br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // but we could do the same with an
"ou_mask" and would get a silly<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // counterpart of m1 (a mask that
matches any files)<br>
&nbsp; libdar::ou_mask m6;<br>
&nbsp; m6.add_mask(m2);<br>
&nbsp; m6.add_mask(m4);<br>
&nbsp; m6.add_mask(m3);<br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // lastly, the NOT, AND and OR operation
can be used recursively.<br>
      </code><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Frankly, it's
possible to have masks reference each other!</code><br>
      <code>&nbsp; libdar::not_mask m7 = m6;<br>
&nbsp; m6.add_mask(m7);<br>
      <br>
      </code></td>
    </tr>
  </tbody>
</table>
<br>
Now that you've seen the power of these masks, you should know that in
libdar there are two masks that are required: <br>
<ul>
  <li style="text-align: justify;">The first mask is used against the
names of all files except directories. It is applied solely to the
names themselves (not the file path). This mask may be any combination
of the masks seen previously; it will only be applied to socket, named
pipes, symbolic links, char or block devices, plain files, but again
not to directories. This way you can filter by file type for save,
restore, list, compare, and compress, and other library operations.</li>
  <li style="text-align: justify;">The second mask is applied to any
file including directories, including the path part of the filename. So
with it you can prune directories, or in any other way restrict the
operation to a particular subdirectory, as well as to a particular
plain file for example.<br>
  </li>
</ul>
<code></code>
<div style="margin-left: 40px; text-align: justify;"></div>
<h2>5 - Let's create a simple archive</h2>
Now that we have seen masks and exceptions let's start the real thing:<br>
&nbsp;
<br>
<table
 style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(153, 255, 255); width: 50%;">
      <p><code>&nbsp; // creating an archive is simple; it is just<br>
&nbsp; // a matter of calling the "create" constructor<br>
&nbsp; // of the archive class. It may be used for full or<br>
&nbsp; // differential archives. We'll see an example of<br>
&nbsp; // of differential archives later.<br>
      <br>
&nbsp; // note that while this example uses a pointer to store<br>
&nbsp; // my_arch, it is perhaps better practice to use a plain<br>
&nbsp; // stack object. In your code, use an object instead of<br>
&nbsp; // a pointer to an object under normal circumstances.<br>
      <br>
libdar::user_interaction_callback dialog =
libdar::user_interaction_callback(ptr1, ptr2, ptr3);<br>
&nbsp; // where ptr1, ptr2 and ptr3 are three callback<br>
&nbsp; // functions.<br>
libdar::statistics ret;<br>
&nbsp; // we will see this structure a bit further<br>
      <br>
libdar::archive *my_arch = <br>
&nbsp; &nbsp;&nbsp; new <span style="font-weight: bold;">libdar::archive</span>(dialog,
      <br>
&nbsp;&nbsp;&nbsp; &nbsp;"/home",&nbsp; // saving all under this "root"<br>
&nbsp;&nbsp;&nbsp; &nbsp;"/tmp",&nbsp;&nbsp; // where the slices will go<br>
&nbsp;&nbsp;&nbsp; &nbsp;NULL,&nbsp;&nbsp;&nbsp;&nbsp; // we do a full
backup for now <br>
&nbsp;&nbsp;&nbsp;&nbsp; libdar::not_mask(simple_mask("*~", true)), <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
we don't save the files ending with<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // '~' this does not concern
directories<br>
&nbsp;&nbsp;&nbsp;&nbsp; libdar::bool_mask(true), <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
all directories and files not rejected <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
by the previous mask are saved<br>
&nbsp;&nbsp;&nbsp; &nbsp;"my_archive",&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
the basename of the slices <br>
&nbsp;&nbsp;&nbsp; &nbsp;"dar", // dar's slice extensions<br>
&nbsp;&nbsp;&nbsp; &nbsp;true,&nbsp; // we allow slice overwriting<br>
&nbsp;&nbsp;&nbsp; &nbsp;true,&nbsp; // but ask to be warned in such
occurrence<br>
&nbsp;&nbsp;&nbsp;&nbsp; false, // we don't want a verbose output<br>
&nbsp;&nbsp;&nbsp; &nbsp;false, // nor do we want to pause between
slices<br>
&nbsp;&nbsp;&nbsp; &nbsp;true,&nbsp; // rejected directories will be
saved as<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // empty (no directory is
rejected so<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // here there is no
importance for that<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // parameter)<br>
&nbsp;&nbsp;&nbsp; &nbsp;libdar::gzip // the archive will be compressed<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // using gzip <br>
&nbsp;&nbsp;&nbsp; &nbsp;9,&nbsp;&nbsp;&nbsp;&nbsp; // at maximum
compression level <br>
&nbsp;&nbsp;&nbsp; &nbsp;0,&nbsp;&nbsp;&nbsp;&nbsp; // no slicing is
done,<br>
&nbsp;&nbsp;&nbsp; &nbsp;0, &nbsp;&nbsp;&nbsp; // so the first slice
size must also be <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
set to zero <br>
&nbsp;&nbsp;&nbsp; &nbsp;true,&nbsp; // root EA will be saved if present<br>
&nbsp;&nbsp;&nbsp; &nbsp;true,&nbsp; // user EA too<br>
&nbsp;&nbsp;&nbsp; &nbsp;"",&nbsp;&nbsp;&nbsp; // no script will be
executed between<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // slices (as there is no
slicing) <br>
&nbsp;&nbsp;&nbsp; &nbsp;libdar::crypto_blowfish, <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
the blowfish strong encryption <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
will be used<br>
&nbsp;&nbsp;&nbsp; &nbsp;"",&nbsp;&nbsp;&nbsp; // as the password is
not given here&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
(empty string is not a valid password) <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
it will be queried interactively<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // through the dialog<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // user_interaction object<br>
&nbsp;&nbsp;&nbsp; &nbsp;20480, // the block of encryption will be<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // 20 kbytes<br>
&nbsp;&nbsp;&nbsp;&nbsp; libdar::not_mask(libdar::simple_mask("*gz")), <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
all files will be compressed except<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // those ending with "gz"<br>
&nbsp;&nbsp;&nbsp; &nbsp;800,&nbsp;&nbsp; // files whose sized is below
800 bytes<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // will not be compressed<br>
&nbsp;&nbsp;&nbsp; &nbsp;false, // all files will be saved regardless of<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // the nodump flag value<br>
&nbsp;&nbsp;&nbsp; &nbsp;false, // as we're making a full backup this <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
"ignore_owner" parameter is useless <br>
&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;0,&nbsp;&nbsp;&nbsp; // hourshift is
useless here as we're making<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // a
full backup<br>
&nbsp;&nbsp;&nbsp; &nbsp;false, // we will make a real archive not a<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // dry-run operation<br>
&nbsp;&nbsp;&nbsp; &nbsp;true,&nbsp; // dar will set back the access
time of<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // file it opens, which will
change the<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // ctime date of theses files
      <br>
&nbsp;&nbsp;&nbsp; &nbsp;false, // we may cross to other filesystems if<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // necessary<br>
&nbsp;&nbsp;&nbsp;&nbsp; ret);&nbsp; // this value is returned by libdar</code><br>
      </p>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(153, 255, 153); width: 50px;"><code></code><code>&nbsp;&nbsp;
// creating an archive is simple; it is just<br>
&nbsp; // a matter of calling the "create" constructor<br>
&nbsp; // of the archive class. It may be used for full or<br>
&nbsp; // differential archives. We'll see an example of<br>
&nbsp; // of differential archives later.<br>
      <br>
&nbsp; // note that while this example uses a pointer to store<br>
&nbsp; // my_arch, it is perhaps better practice to use a plain<br>
&nbsp; // stack object. In your code, use an object instead of<br>
&nbsp; // a pointer to an object under normal circumstances.<br>
      </code><code><br>
libdar::user_interaction_callback dialog =
libdar::user_interaction_callback(ptr1, ptr2, ptr3);<br>
&nbsp; // where ptr1, ptr2 and ptr3 are three callback<br>
&nbsp; // functions.<br>
libdar::statistics ret;<br>
&nbsp; </code><code>// we will see this structure a bit further<br>
      <br>
      </code><code>U_16 exception, <br>
std::string except_msg;</code><br>
      <br>
      <code><span class="el">libdar::archive *my_arch
=&nbsp;&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp; <span style="font-weight: bold;">libdar::create_archive_noexcept</span>(dialog,</span></code><span
 class="el"><code>&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp; "/home",&nbsp; // saving all under this "root"<br>
&nbsp;&nbsp;&nbsp; &nbsp;"/tmp",&nbsp;&nbsp; // where the slices will go<br>
&nbsp;&nbsp;&nbsp; &nbsp;NULL,&nbsp;&nbsp;&nbsp;&nbsp; // we do a full
backup for now <br>
&nbsp;&nbsp;&nbsp;&nbsp; libdar::not_mask(simple_mask("*~", true)), <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
we don't save the files ending with<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // '~' this does not concern
directories<br>
&nbsp;&nbsp;&nbsp;&nbsp; libdar::bool_mask(true), <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
all directories and files not rejected <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
by the previous mask are saved<br>
&nbsp;&nbsp;&nbsp; &nbsp;"my_archive",&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
the basename of the slices <br>
&nbsp;&nbsp;&nbsp; &nbsp;"dar", // dar's slice extensions<br>
&nbsp;&nbsp;&nbsp; &nbsp;true,&nbsp; // we allow slice overwriting<br>
&nbsp;&nbsp;&nbsp; &nbsp;true,&nbsp; // but ask to be warned in such
occurrence<br>
&nbsp;&nbsp;&nbsp;&nbsp; false, // we don't want a verbose output<br>
&nbsp;&nbsp;&nbsp; &nbsp;false, // nor do we want to pause between
slices<br>
&nbsp;&nbsp;&nbsp; &nbsp;true,&nbsp; // rejected directories will be
saved as<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // empty (no directory is
rejected so<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // here there is no
importance for that<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // parameter)<br>
&nbsp;&nbsp;&nbsp; &nbsp;libdar::gzip // the archive will be compressed<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // using gzip <br>
&nbsp;&nbsp;&nbsp; &nbsp;9,&nbsp;&nbsp;&nbsp;&nbsp; // at maximum
compression level <br>
&nbsp;&nbsp;&nbsp; &nbsp;0,&nbsp;&nbsp;&nbsp;&nbsp; // no slicing is
done,<br>
&nbsp;&nbsp;&nbsp; &nbsp;0, &nbsp;&nbsp;&nbsp; // so the first slice
size must also be <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
set to zero <br>
&nbsp;&nbsp;&nbsp; &nbsp;true,&nbsp; // root EA will be saved if present<br>
&nbsp;&nbsp;&nbsp; &nbsp;true,&nbsp; // user EA too<br>
&nbsp;&nbsp;&nbsp; &nbsp;"",&nbsp;&nbsp;&nbsp; // no script will be
executed between<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // slices (as there is no
slicing) <br>
&nbsp;&nbsp;&nbsp; &nbsp;libdar::crypto_blowfish, <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
the blowfish strong encryption <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
will be used<br>
&nbsp;&nbsp;&nbsp; &nbsp;"",&nbsp;&nbsp;&nbsp; // as the password is
not given here&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
(empty string is not a valid password) <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
it will be queried interactively <br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // through the dialog<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // user_interaction object<br>
&nbsp;&nbsp;&nbsp; &nbsp;20480, // the block of encryption will be<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // 20 kbytes<br>
&nbsp;&nbsp;&nbsp;&nbsp; libdar::not_mask(libdar::simple_mask("*gz")), <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
all files will be compressed except<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // those ending with "gz"<br>
&nbsp;&nbsp;&nbsp; &nbsp;800,&nbsp;&nbsp; // files whose size is below
800 bytes<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // will not be compressed<br>
&nbsp;&nbsp;&nbsp; &nbsp;false, // all files will be saved regardless of<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // the nodump flag value<br>
&nbsp;&nbsp;&nbsp; &nbsp;false, // as we're making a full backup this <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
"ignore_owner" parameter is useless <br>
&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;0,&nbsp;&nbsp;&nbsp; // hourshift is
useless here as we're making<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // a
full backup<br>
&nbsp;&nbsp;&nbsp; &nbsp;false, // we will make a real archive not a<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // dry-run operation<br>
&nbsp;&nbsp;&nbsp; &nbsp;true,&nbsp; // dar will set back the access
time of<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // file it opens, which will
change the<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // ctime date of theses files
      <br>
&nbsp;&nbsp;&nbsp; &nbsp;false, // we may cross to other filesystems if<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // necessary<br>
&nbsp;&nbsp;&nbsp;&nbsp; ret,&nbsp;&nbsp; // this value is returned by
libdar<br>
&nbsp;&nbsp;&nbsp;&nbsp; exception, // this gives the status of the call<br>
&nbsp;&nbsp;&nbsp;&nbsp; except_msg); // and in case of error the cause.<br>
      <br>
if(exception != LIBDAR_NOEXCEPT)<br>
&nbsp; std::cout &lt;&lt; "an error occurred: " &lt;&lt; except_msg <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;&lt; std::endl;<br>
      <br>
      </code></span> </td>
    </tr>
  </tbody>
</table>
<br>
<br>
<div style="text-align: justify;">When creating an archive, the created
archive object can be used only as reference for an isolation or for
differential backups. You cannot use it for restoration, listing, or
comparison, because the underlying file descriptors are opened in
write only mode. An implementation which uses file descriptors in
read-write access is not possible and is not a good idea anyway. Why?
Because, for example, if you want to test the newly created archive,
using the newly created object would make the test rely on information
stored in virtual memory (the archive contents, the data location of a
file, etc.), not on the file archive itself. If some corruption occurred
in the file you would not notice it.<br>
</div>
<br>
So to totally complete the archive creation we must destroy the archive
object we have just created, which will also close any file descriptors
used by the object :<br>
<br>
<br>
<table
 style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(153, 255, 255); width: 50%;"><code><br>
&nbsp;&nbsp;&nbsp;&nbsp; delete my_arch;<br>
      <br>
      </code> </td>
      <td
 style="vertical-align: top; background-color: rgb(153, 255, 153); width: 50px;"><code><br>
libdar::close_archive_noexcept(my_arch, exception,<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; except_msg);<br>
      <br>
      </code><span class="el"><code>if(exception != LIBDAR_NOEXCEPT)<br>
&nbsp; std::cout &lt;&lt; "an error occurred: " &lt;&lt; except_msg <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;&lt;
std::endl;<br>
      <br>
      </code></span> </td>
    </tr>
  </tbody>
</table>
<br>
<h2>6 - Testing the archive we have created</h2>
So, as explained previously, we must create a new archive object but
this time with the "read" constructor:<br>
<br>
<code><br>
</code>
<table
 style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(153, 255, 255); width: 50%;"><code><br>
my_arch = new </code><code>libdar::archive(dialog,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; "/tmp",&nbsp; // where is the
archive <br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; "my_archive", // slice name<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; "dar",&nbsp;&nbsp; // dar's
archive extensions<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; libdar::crypto_blowfish, <br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; "",<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; 20480, // theses last three are
for encryptions<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; "",&nbsp;&nbsp;&nbsp; // not used
as we didn't gave "-" as<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; "",&nbsp;&nbsp;&nbsp; // slice
name<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; "",&nbsp;&nbsp;&nbsp; // no
command executed for now<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; false); // no verbose output<br>
      </code> </td>
      <td
 style="vertical-align: top; background-color: rgb(153, 255, 153); width: 50px;"><code><br>
my_arch = </code><code>libdar::open_archive_noexcept(</code><code>dialog,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; "/tmp",&nbsp; // where is the
archive <br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; "my_archive", // slice name<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; "dar",&nbsp;&nbsp; // dar's
archive extensions<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; libdar::crypto_blowfish, <br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; "",<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; 20480, // theses last three are
for encryptions<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; "",&nbsp;&nbsp;&nbsp; // not used
as we didn't gave "-" as<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; "",&nbsp;&nbsp;&nbsp; // slice
name<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; "",&nbsp;&nbsp;&nbsp; // no
command executed for now<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; false, // no verbose output<br>
      </code><span class="el"><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
exception,// this gives the status of the call<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; except_msg); // and in case of
error the <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// cause of the error<br>
      <br>
i</code></span><span class="el"><span class="el"><code>f(exception !=
LIBDAR_NOEXCEPT)<br>
&nbsp; std::cout &lt;&lt; "an error occurred: " &lt;&lt; except_msg <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;&lt;
std::endl;</code></span><br>
      </span><span class="el"><code><br>
      </code></span> </td>
    </tr>
  </tbody>
</table>
<br>
<br>
Now that we have opened the archive we can perform any operation on it.
Let's thus start by testing the archive coherence:<br>
<br>
<br>
<table
 style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(153, 255, 255); width: 50%;"><code><br>
ret = my_arch-&gt;<span class="el">op_test</span>(<span class="el"></span>dialog,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
libdar::bool_mask(true), <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// all files are tested<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
libdar::bool_mask(true), <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
//no directory is prune<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
false); &nbsp;&nbsp; // no verbose output &nbsp;&nbsp;&nbsp; <br>
      </code><br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(153, 255, 153); width: 50px;"><code>&nbsp;
      <br>
      <span class="el">ret = libdar::op_test_noexcept(</span></code><span
 class="el"><code><span class="el"></span>dialog,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
my_arch,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // the archive
to test<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; libdar::bool_mask(true), <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// all files are tested<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; libdar::bool_mask(true), <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
//no directory is prune<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; false, &nbsp;&nbsp; // no verbose
output</code></span><br>
      <span class="el"><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
exception,// this gives the status of the call<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; except_msg); // and in case of
error the <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// cause of the error<br>
      <br>
      </code></span><span class="el"><span class="el"><code>i</code></span><span
 class="el"><span class="el"><code>f(exception != LIBDAR_NOEXCEPT)<br>
&nbsp; std::cout &lt;&lt; "an error occurred: " &lt;&lt; except_msg <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;&lt;
std::endl;<br>
      <br>
      </code></span></span></span> </td>
    </tr>
  </tbody>
</table>
<br>
<div style="text-align: justify;">We have tested the archive, but have
not yet seen the libdar::statistics variable. It can be used when
creating an archive as well as when testing it.&nbsp; This structure
reports the number of files treated, as well as the number files with
errors and the type of error. You can have a look at the API reference
guide for more information about the uses of different fields. Here is
an example, which relies on the <span style="font-style: italic;"><span
 style="font-weight: bold;">class deci</span> </span>to display the
value of an infinint variable:<br>
</div>
<br>
<code></code><code></code>
<table
 style="width: 90%; height: 51px; text-align: left; margin-left: auto; margin-right: auto;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 204);">&nbsp;&nbsp;
      <code>&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp; // we need the <span
 style="font-style: italic;">class deci</span> to display the value of
an infinint:<br>
      </code><code></code><code>#include "deci.hpp"<br>
      <br>
&nbsp;std::cout &lt;&lt; std::string("Number of file treated :")
&lt;&lt; libdar::deci(ret.treated).human() &lt;&lt; std::endl;<br>
      <br>
&nbsp; &nbsp; // or much simpler (but totally equivalent):<br>
&nbsp;std::cout &lt;&lt; std::string("Number of file treated :")
libdar::&lt;&lt; ret.treated &lt;&lt; std::endl;<br>
      </code><br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<div style="text-align: justify;">Note that the use of the class deci
may throw exceptions (in case of lack of memory, for example), and
there is actually no wrapper available to trap the exceptions that may
be thrown by the class<span style="font-style: italic;"> deci</span>.
So you have to protect the code using a<span style="font-style: italic;">
<span style="font-weight: bold;">try {} catch {}</span></span>&nbsp;
statement.<br>
</div>
<br>
<h2>7 - listing archive contents</h2>
The simple way:<br>
<br>
<table
 style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(153, 255, 255); width: 50%;"><code><br>
my_arch-&gt;<span class="el">op_listing</span>(<span class="el"></span>dialog,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
false, // not a verbose output<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
false, // not using the tar-like format<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
bool_mask(true), <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// all filenames are listed<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
false);// do not filter unsaved files&nbsp; <br>
      </code><br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(153, 255, 153); width: 50px;"><code>&nbsp;
      <br>
li<span class="el">bdar::op_test_listing(</span></code><span class="el"><code><span
 class="el"></span>dialog,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></span><span class="el"><code>false,
// not a verbose output<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; false, // not using the tar-like format<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bool_mask(true), <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// all filenames are listed<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; false,// do not filter unsaved
files</code></span><br>
      <span class="el"><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
exception,// this gives the status of the call<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; except_msg); // and in case of
error the <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// cause of the error<br>
      <br>
      </code></span><span class="el"><span class="el"><code>i</code></span><span
 class="el"><span class="el"><code>f(exception != LIBDAR_NOEXCEPT)<br>
&nbsp; std::cout &lt;&lt; "an error occurred: " &lt;&lt; except_msg <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;&lt;
endl;<br>
      <br>
      </code></span></span></span> </td>
    </tr>
  </tbody>
</table>
<br>
<div style="text-align: justify;">By default the library will complete
the listing by calling the<span style="font-style: italic;"> warning()</span>
method of the <span style="font-style: italic;">dialog</span> object
one time for each file listed. The warning text will consist of a
string for each file with the relevant information in columns that
would need to be parsed if individual information was desired. This may
not be appropriate for you and as such there is another way to get
listing information. This requires a simple reimplementation of the <em>user_interaction</em>
object.<br>
<br>
The <span style="font-style: italic;">user_interaction</span> class
has a<span style="font-style: italic;"> </span><span
 style="font-weight: bold; font-style: italic;">listing()</span> method
which provides separate arguments for each piece of information that
can be displayed:<br>
<ul>
  <li>filename, </li>
  <li>permission, </li>
  <li>user, </li>
  <li>group, </li>
  <li>file size,</li>
  <li>last modification date,</li>
  <li>if the file is a directory</li>
  <li>if the file has children or is an empty dir</li>
  <li>file type</li>
  <li>flag about saved data / saved EA / compression used</li>
</ul>
<p><br>
<strong>Technical note:</strong> <em>You may notice that file type is
not explicitly given as a parameter in the listing method. File type is
available as the first byte of the permissions string. This is standard
POSIX stuff except for an extension: </em>"h"<em> for files hard
linked several times. See </em><strong>man 2 stat</strong> <em> for
more information. Note however that in the last arguments of this call,
you may easily know whether a file is a directory or not and whether it
is empty or not.</em></p>
<p>
In the <span style="font-style: italic;">user_interaction</span> class
(a virtual class), the <span style="font-style: italic;">listing()</span>
method is not a pure virtual method, so you are not obliged to
overwrite it, but it has just an empty implementation so it does nothing.
You understand now that, by default, this method is not used. To
activate it, you must call&nbsp;<span style="font-style: italic;">
set_use_listing(true) </span>protected method and of course you will
have to overwrite the <span style="font-style: italic;">listing()</span>
method to have a less silly behavior:<br>
<br>
</p>
</div>
<br>
<code></code><code></code>
<table
 style="width: 90%; height: 51px; text-align: left; margin-left: auto; margin-right: auto;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 204);"><code>&nbsp;&nbsp;&nbsp;
// here follows the definition of our own implementation of<br>
&nbsp;&nbsp;&nbsp; // of a user_interaction class <br>
      <br>
class my_user_interaction : public user_interaction<br>
{<br>
public :<br>
&nbsp; &nbsp;&nbsp; // the inherited pure virtual methods we must define<br>
&nbsp; &nbsp;&nbsp; // as seen at the beginning of this tutorial:<br>
&nbsp; &nbsp;&nbsp; &nbsp; void pause(const std::string &amp; message);<br>
      </code><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; void
warning(const std::string &amp; message);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::string get_string(const
std::string &amp; message, bool echo);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; user_interaction *clone() const;<br>
      <br>
&nbsp;&nbsp;&nbsp; // we can overwrite this method to have splitted
fields for listing:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; void listing(const
std::string &amp; flag,<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; const std::string
&amp; perm,<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; const
std::string &amp; uid,<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; const
std::string &amp; gid,<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp; const std::string &amp;
size,<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; const
std::string &amp; date,<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp; const std::string &amp;
filename,<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; bool
is_dir,<br>
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; bool
has_children);<br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp; // but it will not get used by libdar unless
we call the protected method set_use_listing()<br>
&nbsp;&nbsp;&nbsp;&nbsp; // for example this can be done in the class
constructor :<br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp; my_user_interaction() { <span
 style="font-weight: bold;">set_use_listing(true);</span> };<br>
};<br>
      <br>
      </code> </td>
    </tr>
  </tbody>
</table>
<br>
<div style="text-align: justify;">Now assuming we have implemented the <span
 style="font-style: italic;">listing()</span> method in&nbsp; <span
 style="font-style: italic;">my_user_interaction</span> class, calling <span
 style="font-style: italic;">op_listing()</span> exactly as we did
before, only replacing the <span style="font-style: italic;">dialog</span>
object by one of the <span style="font-style: italic;">my_user_interaction</span>
class. Then this <span style="font-style: italic;">listing()</span>
method will be called for each file to be listed, in place of the <span
 style="font-style: italic;">warning()</span> method.<br>
</div>
<br>
<div style="text-align: justify;">As seen at the beginning of this
tutorial, there is a child class of <span style="font-style: italic;">user_interaction</span>
based on callback functions which is called <span
 style="font-style: italic;">user_interaction_callback</span>. The <span
 style="font-style: italic;">listing()</span> method must also be
activated here. This is done automatically when you give a callback
function to the object, thanks to the <span
 style="font-weight: bold; font-style: italic;">set_listing_callback()</span>
method :<br>
</div>
<br>
<code></code><code></code>
<table
 style="width: 90%; height: 51px; text-align: left; margin-left: auto; margin-right: auto;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 204);"><code>&nbsp;
      </code><code><br>
&nbsp; // our mandatory callback functions:<br>
      <br>
void warning_callback(const std::string &amp;x, void *context)<br>
{<br>
&nbsp;&nbsp;&nbsp; ....<br>
}<br>
&nbsp;<br>
bool answer_callback(const std::string &amp;x, void *context)<br>
{<br>
&nbsp; &nbsp; ....<br>
}<br>
      <br>
std::string string_callback(const std::string &amp;x, bool echo, void
*context)<br>
{<br>
&nbsp;&nbsp;&nbsp; ....<br>
}<br>
      <br>
&nbsp; // let's build a user_interaction_callback object:<br>
      <br>
libdar::user_interaction_callback dialog = <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
libdar::user_interaction_callback(&amp;warning_callback,
&amp;answer_callback, &amp;string_callback, NULL);<br>
      <br>
&nbsp;&nbsp; // at this point our dialog object is perfectly
operational for listing<br>
&nbsp;&nbsp; // but libdar will call the warning_callback function to
list the archive<br>
&nbsp;&nbsp; // contents<br>
      <br>
&nbsp;&nbsp; // a new callback function for listing :<br>
      <br>
void listing_callback(const std::string &amp; flag,<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; const std::string &amp; perm,<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; const std::string &amp; uid,<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; const std::string &amp; gid,<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; const std::string &amp; size,<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; const std::string &amp; date,<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; const std::string &amp; filename,<br>
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp; bool is_dir,<br>
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; bool has_children,<br>
&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; void *context)<br>
{<br>
&nbsp;&nbsp;&nbsp; ....<br>
}<br>
      <br>
      <span style="font-weight: bold;">dialog.set_listing_callback(&amp;listing_callback);</span><br>
      <br>
&nbsp;&nbsp; // now libdar will call the listing_callback function when
we <br>
&nbsp;&nbsp; // use this <span style="font-style: italic;">dialog </span>object
for listing the archive contents.<br>
      </code><br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<br>
<h2>8 - comparing with filesystem</h2>
We can compare file in an archive with the filesystem by calling the<span
 style="font-weight: bold; font-style: italic;"> op_diff</span> method
of the <span style="font-style: italic;">class archive</span>.<br>
<br>
<table
 style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(153, 255, 255); width: 50%;"><code><br>
&nbsp;&nbsp;&nbsp;&nbsp; ret = my_arch-&gt;op_diff(dialog,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"/home", // what directory to take<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// as root we shall<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// compare the archive<br>
&nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// contents to<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
libdar::bool_mask(true),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
libdar::bool_mask(true),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
false,&nbsp;&nbsp; // no verbose output<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
true,&nbsp;&nbsp;&nbsp; // comparing root EA <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
true,&nbsp;&nbsp;&nbsp; // comparing user EA<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
false,&nbsp;&nbsp; // do not ignore ownership<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// differences<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
false);&nbsp; // do not set back atime<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// of read files<br>
      <br>
      <br>
      <br>
      <br>
      <br>
      </code> </td>
      <td
 style="vertical-align: top; background-color: rgb(153, 255, 153); width: 50px;"><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <br>
&nbsp; ret = </code><code>libdar::op_diff_noexcept(dialog,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
my_arch, // the archive to use<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"/home", // what directory to take<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// as root we shall<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// compare the archive<br>
&nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// contents to<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
libdar::bool_mask(true),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
libdar::bool_mask(true),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
false,&nbsp;&nbsp; // no verbose output<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
true,&nbsp;&nbsp;&nbsp; // comparing root EA <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
true,&nbsp;&nbsp;&nbsp; // comparing user EA<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
false,&nbsp;&nbsp; // do not ignore ownership<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// differences<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
false, &nbsp; // do not set back atime<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// of read&nbsp;&nbsp;&nbsp;&nbsp; <br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; files</code><span
 class="el"><code>exception, // this gives the<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; // status of the call<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
except_msg); // and in case of<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; // error the cause of the<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
error<br>
      <br>
      </code></span><span class="el"><span class="el"><code>i</code></span><span
 class="el"><span class="el"><code>f(exception != LIBDAR_NOEXCEPT)<br>
&nbsp; std::cout &lt;&lt; "an error occurred: " &lt;&lt; except_msg <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;&lt;
std::endl;<br>
      <br>
      </code></span></span></span><span class="el"><code></code></span>
      </td>
    </tr>
  </tbody>
</table>
<br>
Simple, no?<br style="font-style: italic;">
<h2>9 - restoring files</h2>
Restoration of files is done by calling the&nbsp;<span
 style="font-style: italic;"> </span><span
 style="font-weight: bold; font-style: italic;">op_extract</span>
method of <em>class archive</em>.<br>
<br>
<table
 style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(153, 255, 255); width: 50%;"><code><br>
ret = my_arch-&gt;<span class="el">op_extract</span>(<span class="el"></span>dialog,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"/tmp",&nbsp;&nbsp; // where to restore files to<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
libdar::bool_mask(true), <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp; &nbsp;&nbsp; // restore any filename<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;
libdar::simple_path_mask("denis/.tcshrc",<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
true),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// but only restore<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// this file or directory<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
false,// overwriting not allowed<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
true, // warn before overwriting<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //
useless here, not overwritting<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; true, //
verbose output<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; true, //
remove files marked as deleted<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// useless here too, as verwriting<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //
has been disabled<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
false,// restore even if a file is more<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// recent, (useless here too)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
true, // restore root EA &nbsp; <br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; true, //
restore user EA <br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; false,//
restore directory structure &nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
false,// restore ownership<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; false,//
don't warn if a file to be <br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //
removed has a type that does<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //
the type of the orginal file &nbsp; <br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;
0,&nbsp;&nbsp; // no daylight saving consideration<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; false);
// not a dry-run execution<br>
      </code><br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(153, 255, 153); width: 50px;"><code>&nbsp;
      <br>
      <span class="el">ret = libdar::op_extract_noexcept(</span></code><span
 class="el"><code><span class="el"></span>dialog,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
my_arch,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // the archive
to test<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></span><span class="el"><code>"/tmp",&nbsp;&nbsp;
// where to restore files to<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; libdar::bool_mask(true), <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// restore any filename<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
libdar::simple_path_mask("denis/.tcshrc",<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; true),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// but only restore<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// this file or directory<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; false,// overwriting not allowed<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; true, // warn before overwriting<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // useless here, not
overwritting<br>
&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; true, // verbose output<br>
&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; true, // remove files marked as deleted<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// useless here too, as verwriting<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // has been disabled<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; false,// restore even if a file is
more<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// recent, (useless here too)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; true, // restore root EA &nbsp; <br>
&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; true, // restore user EA <br>
&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; false,// restore directory structure
&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; false,// restore ownership<br>
&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; false,// don't warn if a file to be <br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // removed has a type
that does<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // the type of the
orginal file &nbsp; <br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; 0,&nbsp;&nbsp; // no daylight
saving consideration<br>
&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; false,// not a dry-run execution</code><br>
      </span><span class="el"><code></code></span><span class="el"><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
exception,// this gives the status of the call<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; except_msg); // and in case of
error the <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// cause of the error<br>
      <br>
      </code></span><span class="el"><span class="el"><code>i</code></span><span
 class="el"><span class="el"><code>f(exception != LIBDAR_NOEXCEPT)<br>
&nbsp; std::cout &lt;&lt; "an error occurred: " &lt;&lt; except_msg <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;&lt;
std::endl;<br>
      <br>
      </code></span></span></span> </td>
    </tr>
  </tbody>
</table>
<br>
<h2>10 - isolating the catalogue</h2>
<div style="text-align: justify;">OK, I know, <span
 style="font-style: italic;">catalogue </span>is not an English word
(one would rather write <span style="font-style: italic;">catalog</span>),
but that's the name of the C++ class used in libdar, so we will keep
using it here. Note that you don't have to directly access this
class (if you really don't like French).<br>
</div>
<br>
<div style="text-align: justify;">Isolating the catalogue creates a new
archive that only contains the list of files and their attributes
(ownership, dates, size, etc.), but no data and no EA are stored in it.
It is very similar to the same archive one gets if one makes a
differential backup of a filesystem that has not changed since the
creation of a reference archive. The usage is very similar to the
archive creation, but it uses a different constructor that has less
arguments :<br>
</div>
<br>
<br>
<table
 style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(153, 255, 255); width: 50%;"><code><br>
libdar::archive *my_cat = new libdar::archive(dialog,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"/tmp",&nbsp; // where the extracted <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp; // catalogue is saved<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
my_arch, // the archive of reference<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// is the one we have been<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// playing with previously<br>
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"my_catalogue", // slice name<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"dar",&nbsp;&nbsp; // file extension<br>
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
true,&nbsp;&nbsp;&nbsp; // allow slice overwriting<br>
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
true,&nbsp;&nbsp;&nbsp; // but warn before<br>
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
true,&nbsp;&nbsp;&nbsp; // verbose output<br>
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
true,&nbsp;&nbsp;&nbsp; // pause between slices<br>
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
libdar::bzip2, // compression<br>
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
9,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // max compression level<br>
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
3000, // cut in slices of 3000 Bytes<br>
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
3000, // first slice size is the same<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"echo slice %p/%b.%n.%e created",<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// the script to run after<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// slice creation<br>
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
libdar::crypto_none, // no encryption<br>
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"",&nbsp;&nbsp;&nbsp; // unused password<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
0,&nbsp;&nbsp;&nbsp;&nbsp; // unused crypto size<br>
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
false); // not a dry-run execution<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; <br>
      </code><br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(153, 255, 153); width: 50px;"><code>&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>
      <span class="el">libdar::archive *my_cat = <br>
&nbsp;&nbsp;&nbsp; libdar::op_isolate_noexcept(dialog,<br>
      </span></code><span class="el"><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp; "/tmp", &nbsp; // where is saved the <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp; // extracted catalogue<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
my_arch, // the archive of reference<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// is the one we have been<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// playing with previously<br>
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"my_catalogue", // slice name<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"dar",&nbsp;&nbsp; // file extension<br>
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
true,&nbsp;&nbsp;&nbsp; // allow slice overwriting<br>
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
true,&nbsp;&nbsp;&nbsp; // but warn before<br>
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
true,&nbsp;&nbsp;&nbsp; // verbose output<br>
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
true,&nbsp;&nbsp;&nbsp; // pause between slices<br>
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
libdar::bzip2, // compression<br>
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
9,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // max compression level<br>
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
3000, // cut in slices of 3000 Bytes<br>
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
3000, // first slice size is the same<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"echo slice %p/%b.%n.%e created",<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// the script to run after<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// slice creation<br>
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
libdar::crypto_none, // no encryption<br>
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"",&nbsp;&nbsp;&nbsp; // unused password<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
0,&nbsp;&nbsp;&nbsp;&nbsp; // unused crypto size<br>
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
false, // not a dry-run execution</code><br>
      </span><span class="el"><code></code></span><span class="el"><code>&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
exception,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // this gives
the status <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // of the call<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
except_msg); <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // and in
case of error the <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // cause of the error<br>
      <br>
      </code></span><span class="el"><span class="el"><code>i</code></span><span
 class="el"><span class="el"><code>f(exception != LIBDAR_NOEXCEPT)<br>
&nbsp; std::cout &lt;&lt; "an error occurred: " &lt;&lt; except_msg <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;&lt;
std::endl;<br>
      <br>
      </code></span></span></span> </td>
    </tr>
  </tbody>
</table>
<br>
<br>
<div style="text-align: justify;">Now we have two archive objects. <span
 style="font-style: italic;">my_arch</span> is a read-only object
created by the "read" constructor. You can do any operations with it,
like file restoration, file comparison, archive testing, as we have
done in the previous sections. The second archive object is <span
 style="font-style: italic;">my_cat</span> which is a write only
object. It can only be used as a reference for another backup (a
differential backup) or as a reference for a subsequent catalogue
isolation (which would just clone the already isolated catalogue object
here).<br>
<br>
Note that, if desired, an isolated catalogue can be tested, compared
with the filesystem, and you can even try to restore files from it. But
as there is no data associated with the files contents, dar will not
restore any files from it, of course. So for now we will just destroy
the extracted catalogue object, so that all its file descriptors are
closed:<br>
<br>
<br>
<table
 style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(153, 255, 255); width: 50%;"><code><br>
delete my_cat; &nbsp;&nbsp; <br>
      </code><br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(153, 255, 153); width: 50px;"><code></code><code><br>
close_archive_noexcept (my_cat, exception,<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; except_msg);<br>
      <br>
      </code><span class="el"><code>if(exception != LIBDAR_NOEXCEPT)<br>
&nbsp; std::cout &lt;&lt; "an error occurred: " &lt;&lt; except_msg <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;&lt;
std::endl;</code></span><code> <br>
      <span class="el"></span></code><span class="el"><span class="el"><span
 class="el"><code><br>
      </code></span></span></span> </td>
    </tr>
  </tbody>
</table>
<br>
and we keep the <span style="font-style: italic;">my_arch</span>
object for our last operation:<br>
</div>
<h2>11 - creating a differential backup</h2>
<div style="text-align: justify;">This operation is the same as the
first one we did (archive creation). Perhaps you have noted that an
argument was set to <span style="font-style: italic;">NULL</span>.
Here we will pass it <span style="font-style: italic;">my_arch </span>which
means that <span style="font-style: italic;">my_arch</span> will
become the reference archive for the archive we will create. If we had
not destroyed <span style="font-style: italic;">my_cat </span>above,
we could have used it in place of <span style="font-style: italic;">my_arch</span>
for exactly the same result.<br>
</div>
<br>
<br>
<table
 style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(153, 255, 255); width: 50%;"><code>&nbsp;
      <br>
libdar::archive *my_other_arch = <br>
&nbsp; &nbsp;&nbsp; new libdar::archive(dialog, <br>
&nbsp;&nbsp;&nbsp; &nbsp;"/home",&nbsp; // saving all under this "root"<br>
&nbsp;&nbsp;&nbsp; &nbsp;"/tmp",&nbsp;&nbsp; // where the slices will go<br>
&nbsp;&nbsp;&nbsp;&nbsp; <span style="font-weight: bold;">my_arch,&nbsp;
// differential backup </span><br>
&nbsp;&nbsp;&nbsp; &nbsp;not_mask(simple_mask("*~", true)), <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
we don't save the files ending with<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // '~' this does not concern
directories<br>
&nbsp;&nbsp;&nbsp; &nbsp;bool_mask(true), <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
all directories and files not rejected <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
by the previous mask are saved<br>
&nbsp;&nbsp;&nbsp; &nbsp;"my_archive",&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
the basename of the slices <br>
&nbsp;&nbsp;&nbsp; &nbsp;"dar", // dar's slice extensions<br>
&nbsp;&nbsp;&nbsp; &nbsp;true,&nbsp; // we allow slice overwriting<br>
&nbsp;&nbsp;&nbsp; &nbsp;true,&nbsp; // but ask to be warned in such
occurrence<br>
&nbsp;&nbsp;&nbsp;&nbsp; false, // we don't want a verbose output<br>
&nbsp;&nbsp;&nbsp; &nbsp;false, // nor we want to pause between slices<br>
&nbsp;&nbsp;&nbsp; &nbsp;true,&nbsp; // rejected directory will be
saved as<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // empty (no directory is
rejected so<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // here there is no
importance for that<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // parameter)<br>
&nbsp;&nbsp;&nbsp; &nbsp;libdar::gzip // the archive will be compressed<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // using gzip <br>
&nbsp;&nbsp;&nbsp; &nbsp;9,&nbsp;&nbsp;&nbsp;&nbsp; // at maximum
compression level <br>
&nbsp;&nbsp;&nbsp; &nbsp;0,&nbsp;&nbsp;&nbsp;&nbsp; // no slicing is
done,<br>
&nbsp;&nbsp;&nbsp; &nbsp;0, &nbsp;&nbsp;&nbsp; // so the first slice
size must also be <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
set to zero <br>
&nbsp;&nbsp;&nbsp; &nbsp;true,&nbsp; // root EA will be saved if present<br>
&nbsp;&nbsp;&nbsp; &nbsp;true,&nbsp; // user EA too<br>
&nbsp;&nbsp;&nbsp; &nbsp;"",&nbsp;&nbsp;&nbsp; // no script will be
executed between<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // slices (as there is no
slicing) <br>
&nbsp;&nbsp;&nbsp; &nbsp;libdar::crypto_blowfish, <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
the blowfish strong encryption <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
will be used<br>
&nbsp;&nbsp;&nbsp; &nbsp;"",&nbsp;&nbsp;&nbsp; // as the password is
not given here&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
(empty string is not a valid password) <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
it will be asked interactively to the<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // user through the dialog<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // user_interaction object<br>
&nbsp;&nbsp;&nbsp; &nbsp;20480, // the block of encryption will be<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // 20 kbytes<br>
&nbsp;&nbsp;&nbsp; &nbsp;not_mask(simple_mask("*gz")), <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
all files will be compressed except<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // those ending by "gz"<br>
&nbsp;&nbsp;&nbsp; &nbsp;800,&nbsp;&nbsp; // file which size is below
800 bytes<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // will not be compressed<br>
&nbsp;&nbsp;&nbsp; &nbsp;false, // all files will be saved whatever is<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // the nodump flag value<br>
&nbsp;&nbsp;&nbsp; &nbsp;false, // as we make a full backup this <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
"ignore_owner" parameter is useless <br>
&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;0,&nbsp;&nbsp;&nbsp; // hourshift is
useless here as we make <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // a
full backup<br>
&nbsp;&nbsp;&nbsp; &nbsp;false, // we will make a real archive not a<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // dry-run operation<br>
&nbsp;&nbsp;&nbsp; &nbsp;true,&nbsp; // dar will set back the access
time of<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // file it opens, which will
change the<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // ctime date of theses files
      <br>
&nbsp;&nbsp;&nbsp; &nbsp;false, // we may change of filesystem if<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // necessary<br>
&nbsp;&nbsp;&nbsp;&nbsp; ret);&nbsp; // this value is returned by libdar</code><br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(153, 255, 153); width: 50px;"><code></code><code>
      </code><br>
      <code><span class="el">libdar::archive *my_other_arch
=&nbsp;&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp; libdar::create_archive_noexcept(dialog,</span></code><span
 class="el"><code>&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp; "/home",&nbsp; // saving all under this "root"<br>
&nbsp;&nbsp;&nbsp; &nbsp;"/tmp",&nbsp;&nbsp; // where the slices will go<br>
      </code></span><span class="el"><code><span
 style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp; my_arch,&nbsp; //
differential backup </span></code></span><span class="el"><code><br>
&nbsp;&nbsp;&nbsp; &nbsp;not_mask(simple_mask("*~", true)), <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
we don't save the files ending with<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // '~' this does not concern
directories<br>
&nbsp;&nbsp;&nbsp; &nbsp;bool_mask(true), <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
all directories and files not rejected <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
by the previous mask are saved<br>
&nbsp;&nbsp;&nbsp; &nbsp;"my_archive",&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
the basename of the slices <br>
&nbsp;&nbsp;&nbsp; &nbsp;"dar", // dar's slice extensions<br>
&nbsp;&nbsp;&nbsp; &nbsp;true,&nbsp; // we allow slice overwriting<br>
&nbsp;&nbsp;&nbsp; &nbsp;true,&nbsp; // but ask to be warned in such
occurrence<br>
&nbsp;&nbsp;&nbsp;&nbsp; false, // we don't want a verbose output<br>
&nbsp;&nbsp;&nbsp; &nbsp;false, // nor we want to pause between slices<br>
&nbsp;&nbsp;&nbsp; &nbsp;true,&nbsp; // rejected directory will be
saved as<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // empty (no directory is
rejected so<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // here there is no
importance for that<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // parameter)<br>
&nbsp;&nbsp;&nbsp; &nbsp;libdar::gzip // the archive will be compressed<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // using gzip <br>
&nbsp;&nbsp;&nbsp; &nbsp;9,&nbsp;&nbsp;&nbsp;&nbsp; // at maximum
compression level <br>
&nbsp;&nbsp;&nbsp; &nbsp;0,&nbsp;&nbsp;&nbsp;&nbsp; // no slicing is
done,<br>
&nbsp;&nbsp;&nbsp; &nbsp;0, &nbsp;&nbsp;&nbsp; // so the first slice
size must also be <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
set to zero <br>
&nbsp;&nbsp;&nbsp; &nbsp;true,&nbsp; // root EA will be saved if present<br>
&nbsp;&nbsp;&nbsp; &nbsp;true,&nbsp; // user EA too<br>
&nbsp;&nbsp;&nbsp; &nbsp;"",&nbsp;&nbsp;&nbsp; // no script will be
executed between<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // slices (as there is no
slicing) <br>
&nbsp;&nbsp;&nbsp; &nbsp;libdar::crypto_blowfish, <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
the blowfish strong encryption <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
will be used<br>
&nbsp;&nbsp;&nbsp; &nbsp;"",&nbsp;&nbsp;&nbsp; // as the password is
not given here&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
(empty string is not a valid password) <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
it will be asked interactively to the<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // user through the dialog<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // user_interaction object<br>
&nbsp;&nbsp;&nbsp; &nbsp;20480, // the block of encryption will be<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // 20 kbytes<br>
&nbsp;&nbsp;&nbsp; &nbsp;not_mask(simple_mask("*gz")), <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
all files will be compressed except<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // those ending by "gz"<br>
&nbsp;&nbsp;&nbsp; &nbsp;800,&nbsp;&nbsp; // file which size is below
800 bytes<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // will not be compressed<br>
&nbsp;&nbsp;&nbsp; &nbsp;false, // all files will be saved whatever is<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // the nodump flag value<br>
&nbsp;&nbsp;&nbsp; &nbsp;false, // as we make a full backup this <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //
"ignore_owner" parameter is useless <br>
&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;0,&nbsp;&nbsp;&nbsp; // hourshift is
useless here as we make <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // a
full backup<br>
&nbsp;&nbsp;&nbsp; &nbsp;false, // we will make a real archive not a<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // dry-run operation<br>
&nbsp;&nbsp;&nbsp; &nbsp;true,&nbsp; // dar will set back the access
time of<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // file it opens, which will
change the<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // ctime date of theses files
      <br>
&nbsp;&nbsp;&nbsp; &nbsp;false, // we may change of filesystem if<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // necessary<br>
&nbsp;&nbsp;&nbsp;&nbsp; ret,&nbsp;&nbsp; // this value is returned by
libdar<br>
&nbsp;&nbsp;&nbsp;&nbsp; exception, // thisgives the status of the call<br>
&nbsp;&nbsp;&nbsp;&nbsp; except_msg); // and in case of error the cause.<br>
      <br>
if(exception != LIBDAR_NOEXCEPT)<br>
&nbsp; std::cout &lt;&lt; "an error occurred: " &lt;&lt; except_msg <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;&lt;
std::endl;<br>
      <br>
      </code></span> </td>
    </tr>
  </tbody>
</table>
<br>
As previously, my_other_arch is a write only object that we won't need
anymore. So we destroy it:<br>
<br>
<table
 style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(153, 255, 255); width: 50%;"><code><br>
&nbsp;&nbsp;&nbsp;&nbsp; delete my_other_arch;<br>
      <br>
      </code> </td>
      <td
 style="vertical-align: top; background-color: rgb(153, 255, 153); width: 50px;"><code><br>
libdar::close_archive_noexcept(my_other_arch,<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; exception,<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; except_msg);<br>
      <br>
      </code><span class="el"><code>if(exception != LIBDAR_NOEXCEPT)<br>
&nbsp; std::cout &lt;&lt; "an error occurred: " &lt;&lt; except_msg <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;&lt;
std::endl;<br>
      <br>
      </code></span> </td>
    </tr>
  </tbody>
</table>
<br>
<br>
<br>
So, we are at the end of the tutorial. We still have an object we need
to destroy to cleanly release the memory used:<br>
<br>
<br>
<table
 style="width: 90%; text-align: left; margin-left: auto; margin-right: auto;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(153, 255, 255); width: 50%;"><code><br>
&nbsp;&nbsp;&nbsp;&nbsp; delete my_arch;<br>
      <br>
      </code> </td>
      <td
 style="vertical-align: top; background-color: rgb(153, 255, 153); width: 50px;"><code><br>
libdar::close_archive_noexcept(my_arch, exception,<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; except_msg);<br>
      <br>
      </code><span class="el"><code>if(exception != LIBDAR_NOEXCEPT)<br>
&nbsp; std::cout &lt;&lt; "an error occurred: " &lt;&lt; except_msg <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;&lt;
std::endl;<br>
      <br>
      </code></span> </td>
    </tr>
  </tbody>
</table>
<br>
<br>
For more detailed information about the API you can build the API
documentation from the source code using Doxygen.<br>
<br>
<br>
<h2>12 - Compilation &amp; Linking<br>
</h2>
<h3>Compilation</h3>
All the symbols found in the libdar API are defined via <span
 style="font-style: italic; font-weight: bold;">&lt;dar/libdar.h&gt;</span>
so you should only need to include this header.<br>
<br>
<br>
<code></code><code></code>
<table
 style="width: 90%; height: 51px; text-align: left; margin-left: auto; margin-right: auto;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 204);"><br>
      <code></code>&gt; cat my_prog.cpp<span style="font-weight: bold;"><br>
#include &lt;dar/libdar.h&gt;</span><br>
      <br>
main()<br>
{<br>
&nbsp;&nbsp; libdar::get_version(...);<br>
&nbsp;&nbsp; ...<br>
}<br>
&gt; gcc -c my_prog.cpp<br>
      <br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<br>
<h3>Linking</h3>
Of course, you need to link your program with libdar. This is done by
adding <span style="font-style: italic; font-weight: bold;">-ldar</span>
:<br>
<br>
<br>
<code></code><code></code>
<table
 style="width: 90%; height: 51px; text-align: left; margin-left: auto; margin-right: auto;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 204);"><code>&nbsp;
      </code><code></code><span style="font-weight: bold;"></span><br>
&gt; gcc <span style="font-weight: bold;">-ldar</span> my_prog.o -o
my_prog<br>
      <br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<br>
<h3>Libdar's different flavors</h3>
Well, all the compilation and linking steps described above assume you
have a "<span style="font-style: italic;">full</span>" libdar library.
Beside the <span style="font-style: italic;">full</span> (alias <span
 style="font-style: italic;">infinint</span>) libdar flavor, libdar
also comes in 32 and 64 bits
versions. In theses last ones, in place of internally relying on a
special type (which
is a C++ class called<span style="font-style: italic;"> infinint</span>)
to
handle arbitrary large integers, libdar32 relies on 32 bits integers
and
libdar64 relies on 64 bits integers (there are limitations which are
described in doc/LIMITATIONS). But all theses libdar version (infinint,
32bits, 64bits) have the same
interface and must be used the same way, except for compilation and
linking.<br>
<br>
Theses different libdar versions can coexist on the same system, they
share the same include files. But the MODE macro must be set to 32
or 64 when compiling for linking with libdar32 or libdar64
respectively. The MODE macro defines the way the "<span
 style="font-style: italic;">class infinint" </span>type is
implemented in libdar, and thus changes the way the libdar headers
files are interpreted by the compiler.<br>
<br>
<code></code><code></code>
<table
 style="width: 90%; height: 51px; text-align: left; margin-left: auto; margin-right: auto;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 204);"><code></code>&gt;
cat my_prog.cpp<span style="font-weight: bold;"><br>
      </span>#include &lt;dar/libdar.h&gt;<br>
      <br>
main()<br>
{<br>
&nbsp;&nbsp; libdar::get_version(...);<br>
&nbsp;&nbsp; ...<br>
}<br>
&gt; gcc -c <span style="font-weight: bold;">-DMODE=32</span>
my_prog.cpp<br>
      <br>
      <code></code><code></code><span style="font-weight: bold;"></span><br>
&gt; gcc <span style="font-weight: bold;">-ldar32</span> my_prog.o -o
my_prog<br>
      <br>
      </td>
    </tr>
  </tbody>
</table>
<br>
and replace 32 by 64 to link with libdar64.<br>
<br>
<hr style="width: 100%; height: 2px;">
<h2>Thanks</h2>
I would like to thank Wesley Leggette for having given his feedback and
having done grammar corrections to this document.<br>
<br>
Regards,<br>
Denis Corbin.<br>
<br>
</body>
</html>
